<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBH Simulation Dashboard</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background: #0a0a1a; color: #eee; }
  .tab { overflow: hidden; background-color: #111; }
  .tab button { background-color: inherit; float: left; border: none; outline: none; color: white; padding: 12px 16px; cursor: pointer; }
  .tab button:hover { background-color: #222; }
  .tab button.active { background-color: #444; }
  .tabcontent { display: none; padding: 10px; }
  canvas { display: block; margin: 10px auto; border-radius: 6px; }
  audio { display: block; margin: 10px auto; width: 80%; }
  .mini-window { position: fixed; top: 50px; right: 20px; width: 320px; max-height: 400px; background:#111; border:1px solid #555; padding:10px; overflow:auto; color:#eee; display:none; z-index:999; }
  .mini-window button { float:right; background:#333; color:#eee; border:none; cursor:pointer; }
  label, input, select { margin:5px; }
  .section { margin:10px 0; }
</style>
</head>
<body>

<h1 style="text-align:center;">Binary Black Hole Simulation Dashboard</h1>

<div class="tab">
  <button class="tablinks active" onclick="openTab(event,'Overview')">Overview</button>
  <button class="tablinks" onclick="openTab(event,'EventsCustom')">Events & Custom Simulation</button>
  <button class="tablinks" onclick="openTab(event,'AdvancedPhysics')">Advanced Physics</button>
</div>

<!-- Overview Tab -->
<div id="Overview" class="tabcontent" style="display:block;">
  <h2>Overview of BBH Simulation</h2>
  <p>Interactive demonstration of binary black hole inspirals.</p>
  <div class="section">
    <canvas id="orbit3D" width="400" height="400"></canvas>
  </div>
  <div class="section">
    <canvas id="chirpGraph" width="600" height="200"></canvas>
  </div>
  <div class="section">
    <canvas id="spectrogram" width="600" height="200"></canvas>
  </div>
  <audio id="chirpAudio" controls>
    <source src="" type="audio/wav">
    Your browser does not support audio playback.
  </audio>
</div>

<!-- Events & Custom Simulation Tab -->
<div id="EventsCustom" class="tabcontent">
  <h2>Known Events & Custom Simulation</h2>
  <div class="section">
    <label for="eventSelect">Choose an event:</label>
    <select id="eventSelect" onchange="onEventChange()">
      <option value="">--Select Event--</option>
      <option value="GW150914">GW150914</option>
      <option value="GW151226">GW151226</option>
      <option value="GW170104">GW170104</option>
      <option value="GW170817">GW170817</option>
      <option value="Custom">Custom Simulation</option>
    </select>
  </div>
  <div id="customParams" class="section" style="display:none;">
    <label>Mass1 (M☉): <input type="number" id="mass1" value="30"></label>
    <label>Mass2 (M☉): <input type="number" id="mass2" value="30"></label>
    <label>Spin1: <input type="number" id="spin1" value="0"></label>
    <label>Spin2: <input type="number" id="spin2" value="0"></label>
    <button onclick="updateSimulation('Custom')">Run Custom Simulation</button>
  </div>
  <div class="section">
    <canvas id="orbit3DEvent" width="400" height="400"></canvas>
    <canvas id="chirpGraphEvent" width="600" height="200"></canvas>
    <canvas id="spectrogramEvent" width="600" height="200"></canvas>
  </div>
  <audio id="chirpAudioEvent" controls>
    <source src="" type="audio/wav">
    Your browser does not support audio playback.
  </audio>
  <div class="section">
    <button onclick="exportSimulation()">Export Simulation Data</button>
  </div>
</div>

<!-- Advanced Physics Tab -->
<div id="AdvancedPhysics" class="tabcontent">
  <h2>Advanced Physics</h2>
  <button onclick="toggleMini('equationsWin')">Show/Hide Equations</button>
  <div id="equationsWin" class="mini-window">
    <button onclick="closeMini('equationsWin')">X</button>
    <h3>Key Equations</h3>
    <p>Schwarzschild radius: r_s = 2GM/c²</p>
    <p>Chirp mass: ℳ = (M1 M2)^(3/5)/(M1+M2)^(1/5)</p>
    <p>GW strain: h ~ (4G^(5/3)/c⁴) (ℳ^(5/3) f^(2/3)/D)</p>
    <p>Neutrino flux: Fν ~ Lν/(4πD²)</p>
    <p>Timing: t_arr = t_em + D/v</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script>
// Tab handling
function openTab(evt, tabName) {
  const tabcontent=document.getElementsByClassName("tabcontent");
  for(let i=0;i<tabcontent.length;i++) tabcontent[i].style.display="none";
  const tablinks=document.getElementsByClassName("tablinks");
  for(let i=0;i<tablinks.length;i++) tablinks[i].className=tablinks[i].className.replace(" active","");
  document.getElementById(tabName).style.display="block";
  evt.currentTarget.className+=" active";
}

// Mini windows
function toggleMini(id){const win=document.getElementById(id);win.style.display=win.style.display==="block"?"none":"block";}
function closeMini(id){document.getElementById(id).style.display="none";}

// Orbit 3D
function drawOrbit3D(canvasId,m1=30,m2=30){
  const canvas=document.getElementById(canvasId);
  const scene=new THREE.Scene();
  const camera=new THREE.PerspectiveCamera(75,canvas.width/canvas.height,0.1,1000);
  const renderer=new THREE.WebGLRenderer({canvas:canvas,alpha:true});
  renderer.setSize(canvas.width,canvas.height);
  const geometry=new THREE.SphereGeometry(0.2,16,16);
  const material1=new THREE.MeshBasicMaterial({color:0xffaa00});
  const material2=new THREE.MeshBasicMaterial({color:0x00aaff});
  const bh1=new THREE.Mesh(geometry,material1);
  const bh2=new THREE.Mesh(geometry,material2);
  scene.add(bh1);scene.add(bh2);
  camera.position.z=5;
  let t=0;
  function animate(){
    t+=0.01*(m1+m2)/60;
    bh1.position.x=Math.sin(t)*1; bh1.position.y=Math.cos(t)*1;
    bh2.position.x=-Math.sin(t)*1; bh2.position.y=-Math.cos(t)*1;
    renderer.render(scene,camera);
    requestAnimationFrame(animate);
  }
  animate();
}

// Chirp Graph
function drawChirp(canvasId,m1=30,m2=30){
  const canvas=document.getElementById(canvasId);
  const ctx=canvas.getContext("2d");
  const t=Array.from({length:600},(_,i)=>i/10);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="#ff8800"; ctx.beginPath();
  t.forEach((x,i)=>{
    const freq=0.2+0.001*(m1+m2);
    const y=100+50*Math.sin(freq*x)*Math.exp(-0.002*x);
    if(i===0) ctx.moveTo(i,y); else ctx.lineTo(i,y);
  });
  ctx.stroke();
}

// Spectrogram
function drawSpectrogram(canvasId){
  const canvas=document.getElementById(canvasId);
  const ctx=canvas.getContext("2d");
  const w=canvas.width,h=canvas.height;
  const img=ctx.createImageData(w,h);
  for(let i=0;i<w;i++){
    for(let j=0;j<h;j++){
      const index=(j*w+i)*4;
      img.data[index]=Math.floor(100+155*Math.random());
      img.data[index+1]=Math.floor(50+50*Math.random());
      img.data[index+2]=Math.floor(200*Math.random());
      img.data[index+3]=255;
    }
  }
  ctx.putImageData(img,0,0);
}

// Initialize Overview
drawOrbit3D("orbit3D"); drawChirp("chirpGraph"); drawSpectrogram("spectrogram");

// Events & Custom Simulation
const eventAudioMap={
  "GW150914":"https://example.com/audio/GW150914.wav",
  "GW151226":"https://example.com/audio/GW151226.wav",
  "GW170104":"https://example.com/audio/GW170104.wav",
  "GW170817":"https://example.com/audio/GW170817.wav"
};

function onEventChange(){
  const sel=document.getElementById("eventSelect").value;
  const custom=document.getElementById("customParams");
  if(sel==="Custom"){
    custom.style.display="block";
  } else {
    custom.style.display="none";
    if(sel!==""){
      updateSimulation(sel);
    }
  }
}

function updateSimulation(event){
  let m1=30,m2=30;
  if(event==="Custom"){
    m1=parseFloat(document.getElementById("mass1").value);
    m2=parseFloat(document.getElementById("mass2").value);
  }
  drawOrbit3D("orbit3DEvent",m1,m2);
  drawChirp("chirpGraphEvent",m1,m2);
  drawSpectrogram("spectrogramEvent");
  const audio=document.getElementById("chirpAudioEvent");
  if(eventAudioMap[event]) audio.src=eventAudioMap[event];
  else audio.src=""; // For Custom, optionally generate audio dynamically
  audio.load();
  audio.play();
}

function exportSimulation(){
  const m1=document.getElementById("mass1").value;
  const m2=document.getElementById("mass2").value;
  const spin1=document.getElementById("spin1").value;
  const spin2=document.getElementById("spin2").value;
  const data={m1,m2,spin1,spin2};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="simulation.json"; a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
