<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üåå Open Gravitational Wave Explorer</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: radial-gradient(ellipse at center, #02030a 0%, #000 100%);
      color: #fff;
      margin: 0;
      overflow-x: hidden;
    }
    header {
      text-align: center;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.6);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.2rem;
    }
    .controls {
      text-align: center;
      margin-top: 1rem;
    }
    select,
    button,
    input[type="range"] {
      background: #0a0a20;
      color: white;
      border: 1px solid #444;
      border-radius: 0.5rem;
      padding: 0.5rem 1rem;
      margin: 0.3rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    select:hover,
    button:hover {
      background: #1a1a3d;
    }
    #chart {
      width: 90%;
      max-width: 800px;
      margin: 2rem auto;
      border-radius: 1rem;
      background: #0d0d20;
      padding: 1rem;
    }
    #customControls {
      display: none;
      text-align: center;
      margin-top: 1rem;
      animation: fadeIn 0.5s ease;
    }
    label {
      margin: 0.3rem;
      display: inline-block;
    }

    /* Modal */
    #infoModal {
      display: none;
      opacity: 0;
      position: fixed;
      z-index: 50;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.75);
      justify-content: center;
      align-items: center;
      transition: opacity 0.4s ease;
    }
    #infoModal.show {
      display: flex;
      opacity: 1;
    }
    .modal-content {
      background: #111;
      padding: 2rem;
      border-radius: 1rem;
      max-width: 600px;
      text-align: left;
      position: relative;
      transform: scale(0.95);
      transition: transform 0.4s ease;
    }
    #infoModal.show .modal-content {
      transform: scale(1);
    }
    .close {
      position: absolute;
      top: 0.5rem;
      right: 1rem;
      font-size: 1.8rem;
      cursor: pointer;
      color: #aaa;
    }
    .close:hover {
      color: white;
    }
    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
      opacity: 0.7;
    }
    .learn-btn {
      margin-top: 1rem;
      background: #003366;
      border: 1px solid #00aaff;
    }
    .learn-btn:hover {
      background: #005599;
    }

    /* Learn More Panel */
    #learnPanel {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      background: #050510;
      border-top: 2px solid #00aaff;
      color: #fff;
      padding: 1rem;
      text-align: center;
      transition: bottom 0.5s ease;
      z-index: 60;
    }
    #learnPanel.show {
      bottom: 0;
    }
    #orbitCanvas {
      display: block;
      margin: 1rem auto;
      background: #000;
      border-radius: 8px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>

<body>
  <header>
    <h1>üåå Open Gravitational Wave Explorer</h1>
    <p>Explore real and simulated black hole mergers</p>
  </header>

  <div class="controls">
    <label for="eventSelect">Choose an Event:</label>
    <select id="eventSelect">
      <option value="gw150914">GW150914 ‚Äì First LIGO Detection</option>
      <option value="gw170104">GW170104 ‚Äì Intermediate Mass Merger</option>
      <option value="gw190521">GW190521 ‚Äì Massive BH Merger</option>
      <option value="custom">üß™ Custom Simulation</option>
    </select>
    <button id="simulateBtn">Simulate</button>
    <button id="infoBtn">‚ÑπÔ∏è Info</button>
  </div>

  <div id="customControls">
    <h3>Customize Your Black Holes</h3>
    <div>
      <label>M‚ÇÅ: <span id="m1Val">30</span> M‚òâ</label>
      <input type="range" id="m1Slider" min="5" max="80" value="30">
    </div>
    <div>
      <label>M‚ÇÇ: <span id="m2Val">25</span> M‚òâ</label>
      <input type="range" id="m2Slider" min="5" max="80" value="25">
    </div>
    <div>
      <label>Spin‚ÇÅ: <span id="s1Val">0.3</span></label>
      <input type="range" id="s1Slider" min="0" max="1" step="0.01" value="0.3">
    </div>
    <div>
      <label>Spin‚ÇÇ: <span id="s2Val">0.2</span></label>
      <input type="range" id="s2Slider" min="0" max="1" step="0.01" value="0.2">
    </div>
  </div>

  <div id="chart"></div>

  <!-- Info Modal -->
  <div id="infoModal">
    <div class="modal-content">
      <span id="closeInfo" class="close">&times;</span>
      <h2>üåÄ Understanding Gravitational Waves</h2>
      <p><strong>Gravitational Strain (h):</strong> Measures how space-time is stretched and squeezed as a wave passes.</p>
      <p><strong>Chirp Mass:</strong> Controls how quickly the wave frequency increases before merger.</p>
      <p><strong>Spins:</strong> Can speed up or slow down the inspiral depending on alignment.</p>
      <button id="learnMoreBtn" class="learn-btn">üìñ Learn More</button>
    </div>
  </div>

  <!-- Learn More Panel -->
  <div id="learnPanel">
    <h3>üî≠ Chirp Mass & Wave Evolution</h3>
    <canvas id="orbitCanvas" width="300" height="200"></canvas>
    <button id="closeLearn">Close</button>
  </div>

  <footer>
    <p>Created for the Open BBH Simulation Project ‚Ä¢ Powered by Plotly</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const infoBtn = document.getElementById("infoBtn");
      const infoModal = document.getElementById("infoModal");
      const closeInfo = document.getElementById("closeInfo");
      const learnMoreBtn = document.getElementById("learnMoreBtn");
      const learnPanel = document.getElementById("learnPanel");
      const closeLearn = document.getElementById("closeLearn");

      infoModal.style.display = "none";
      infoBtn.addEventListener("click", () => {
        infoModal.style.display = "flex";
        requestAnimationFrame(() => infoModal.classList.add("show"));
      });
      const closeModal = () => {
        infoModal.classList.remove("show");
        setTimeout(() => (infoModal.style.display = "none"), 400);
      };
      closeInfo.addEventListener("click", closeModal);
      infoModal.addEventListener("click", e => { if (e.target === infoModal) closeModal(); });

      learnMoreBtn.addEventListener("click", () => {
        learnPanel.classList.add("show");
        startOrbitAnimation();
        playChirpSound();
      });
      closeLearn.addEventListener("click", () => {
        learnPanel.classList.remove("show");
      });
    });

    // Simulation logic
    document.addEventListener("DOMContentLoaded", () => {
      const chartDiv = document.getElementById("chart");
      const simulateBtn = document.getElementById("simulateBtn");
      const eventSelect = document.getElementById("eventSelect");
      const customControls = document.getElementById("customControls");

      const m1Slider = document.getElementById("m1Slider");
      const m2Slider = document.getElementById("m2Slider");
      const s1Slider = document.getElementById("s1Slider");
      const s2Slider = document.getElementById("s2Slider");

      const m1Val = document.getElementById("m1Val");
      const m2Val = document.getElementById("m2Val");
      const s1Val = document.getElementById("s1Val");
      const s2Val = document.getElementById("s2Val");

      function updateLabels() {
        m1Val.textContent = m1Slider.value;
        m2Val.textContent = m2Slider.value;
        s1Val.textContent = s1Slider.value;
        s2Val.textContent = s2Slider.value;
      }

      [m1Slider, m2Slider, s1Slider, s2Slider].forEach(slider =>
        slider.addEventListener("input", updateLabels)
      );

      function generateWaveform(event) {
        let freq, decay, label;

        if (event === "custom") {
          customControls.style.display = "block";
          const m1 = parseFloat(m1Slider.value);
          const m2 = parseFloat(m2Slider.value);
          const s1 = parseFloat(s1Slider.value);
          const s2 = parseFloat(s2Slider.value);
          const chirpMass = Math.pow((m1 * m2), 3/5) / Math.pow(m1 + m2, 1/5);
          freq = 0.1 + (50 / chirpMass) * 0.002;
          decay = 0.001 + (s1 + s2) * 0.001;
          label = `Custom: M‚ÇÅ=${m1}, M‚ÇÇ=${m2}`;
        } else {
          customControls.style.display = "none";
          if (event === "gw150914") { freq = 0.25; decay = 0.002; label = "GW150914"; }
          else if (event === "gw170104") { freq = 0.18; decay = 0.0018; label = "GW170104"; }
          else if (event === "gw190521") { freq = 0.12; decay = 0.001; label = "GW190521"; }
        }

        const t = Array.from({ length: 2000 }, (_, i) => i / 20);
        const hPlus = t.map(x => Math.sin(freq * x) * Math.exp(-decay * x));
        const hCross = t.map(x => Math.cos(freq * x) * Math.exp(-decay * x));

        Plotly.newPlot(chartDiv, [
          { x: t, y: hPlus, mode: 'lines', name: 'h‚Çä', line: { width: 2 } },
          { x: t, y: hCross, mode: 'lines', name: 'h√ó', line: { width: 2 } }
        ], {
          title: `${label} ‚Äì Simulated Waveform`,
          xaxis: { title: 'Time (M)' },
          yaxis: { title: 'Strain (h)' },
          plot_bgcolor: '#0d0d20',
          paper_bgcolor: '#0d0d20',
          font: { color: 'white' }
        }, { responsive: true });
      }

      eventSelect.addEventListener("change", () => {
        customControls.style.display = (eventSelect.value === "custom") ? "block" : "none";
      });

      simulateBtn.addEventListener("click", () => generateWaveform(eventSelect.value));
      generateWaveform("gw150914");
    });

    // Orbit animation + chirp sound
    function startOrbitAnimation() {
      const canvas = document.getElementById("orbitCanvas");
      const ctx = canvas.getContext("2d");
      let angle = 0;
      function draw() {
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        const r = 70;
        const cx = canvas.width / 2, cy = canvas.height / 2;
        const x1 = cx + r * Math.cos(angle);
        const y1 = cy + r * Math.sin(angle);
        const x2 = cx - r * Math.cos(angle);
        const y2 = cy - r * Math.sin(angle);
        ctx.beginPath();
        ctx.fillStyle = "#00aaff";
        ctx.arc(x1, y1, 10, 0, 2 * Math.PI);
        ctx.arc(x2, y2, 10, 0, 2 * Math.PI);
        ctx.fill();
        angle += 0.05;
        requestAnimationFrame(draw);
      }
      draw();
    }

    function playChirpSound() {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = "sine";
      osc.connect(gain);
      gain.connect(audioCtx.destination);

      const duration = 3; // seconds
      const startFreq = 100; // Hz
      const endFreq = 800; // Hz

      const now = audioCtx.currentTime;
      osc.frequency.setValueAtTime(startFreq, now);
      osc.frequency.exponentialRampToValueAtTime(endFreq, now + duration);
      gain.gain.setValueAtTime(0.1, now);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);

      osc.start(now);
      osc.stop(now + duration);
    }
  </script>
</body>
</html>
