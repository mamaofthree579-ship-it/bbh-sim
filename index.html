<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBH Simulation ‚Äì Interactive Visualizer</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
  body {
    background:#060606; color:#eee;
    font-family:system-ui, sans-serif;
    margin:0; padding:0;
    overflow-x:hidden;
  }
  header {
    text-align:center;
    padding:1rem;
    font-size:1.4rem;
    font-weight:bold;
    color:#88e0ff;
  }
  #controls { text-align:center; margin:1rem 0; }
  select, button, input {
    background:#111; color:#eee;
    border:1px solid #333;
    border-radius:6px;
    padding:6px 10px; margin:4px;
  }
  #mainChart, #spectrogram, #orbit { width:100%; height:300px; }
  #customOptions { display:none; text-align:center; margin-top:1rem; }
  #playerBar {
    position:fixed;
    bottom:10px; right:10px;
    background:rgba(0,0,0,0.7);
    border:1px solid #444;
    border-radius:12px;
    padding:8px 12px;
    display:flex; align-items:center; gap:10px;
    backdrop-filter: blur(6px);
  }
  #progress {
    width:120px; height:6px;
    background:#222; border-radius:3px;
    overflow:hidden;
  }
  #progress span {
    display:block; height:100%; width:0%;
    background:#00e0ff; transition:width 0.05s linear;
  }
  #playerBar button {
    background:none; border:none; color:#fff; font-size:1.2rem;
  }
  #playerBar button:hover { color:#00e0ff; cursor:pointer; }
</style>
</head>
<body>
<header>üåÄ Binary Black Hole Simulation Visualizer</header>

<div id="controls">
  <select id="eventSelect">
    <option value="gw150914">GW150914</option>
    <option value="gw170817">GW170817</option>
    <option value="gw190521">GW190521</option>
    <option value="custom">Custom Simulation</option>
  </select>
  <button id="runBtn">Run Simulation</button>
</div>

<div id="customOptions">
  <label>Mass 1 (M‚òâ): <input type="number" id="mass1" value="30"></label>
  <label>Mass 2 (M‚òâ): <input type="number" id="mass2" value="35"></label>
  <label>Spin 1 (œá): <input type="number" step="0.1" id="spin1" value="0.2"></label>
  <label>Spin 2 (œá): <input type="number" step="0.1" id="spin2" value="0.1"></label>
  <button id="generateBtn">Generate</button>
</div>

<div id="mainChart"></div>
<div id="spectrogram"></div>
<div id="orbit"></div>

<div id="playerBar">
  <button id="playPause">‚ñ∂Ô∏è</button>
  <button id="restart">üîÅ</button>
  <div id="progress"><span></span></div>
  <button id="soundToggle">üîá Enable Sound</button>
</div>

<script>
/* ---------- Utility & Mock Data ---------- */
let playing=false, t=0, dt=0.05, duration=20, timer;
let audioCtx, osc;
let soundEnabled=false;
const progressEl=document.querySelector('#progress span');

function generateWave(m1,m2){
  const n=800;
  const t=Array.from({length:n},(_,i)=>i/n*duration);
  const amp=(m1+m2)/70;
  const h=t.map(v=>amp*Math.sin(0.4*v*v)*Math.exp(-0.01*v));
  return {t,h};
}

function plotWaveform(data){
  Plotly.newPlot('mainChart',[{
    x:data.t, y:data.h, mode:'lines', line:{color:'#00e0ff'},
    name:'h‚Çä(t)'
  }],{
    paper_bgcolor:'#060606', plot_bgcolor:'#060606',
    xaxis:{title:'Time [M]'}, yaxis:{title:'Strain'},
    margin:{t:40,l:50,r:20,b:40}, title:'Gravitational-Wave Strain'
  });
}

function plotSpectrogram(data){
  const freq=data.t.map(v=>v);
  const amp=data.h.map(v=>Math.abs(v));
  Plotly.newPlot('spectrogram',[{
    x:data.t, y:freq, z:amp.map(a=>[a]), type:'heatmap',
    colorscale:'Viridis', showscale:false
  }],{
    paper_bgcolor:'#060606', plot_bgcolor:'#060606',
    title:'Chirp Spectrogram', margin:{t:40,l:50,r:20,b:40}
  });
}

function plotOrbit(progress){
  const theta=Array.from({length:60},(_,i)=>i/60*2*Math.PI);
  const r=1.5-progress*1.5;
  const x1=theta.map(th=>r*Math.cos(th));
  const y1=theta.map(th=>r*Math.sin(th));
  const x2=x1.map(v=>-v), y2=y1.map(v=>-y1[x1.indexOf(v)]);
  Plotly.newPlot('orbit',[
    {x:[x1[0]],y:[y1[0]],mode:'markers',marker:{size:12,color:'#00e0ff'},name:'BH1'},
    {x:[x2[0]],y:[y2[0]],mode:'markers',marker:{size:12,color:'#ff0077'},name:'BH2'},
  ],{
    paper_bgcolor:'#060606', plot_bgcolor:'#060606',
    title:'Binary Orbit', xaxis:{visible:false}, yaxis:{visible:false}
  });
}

/* ---------- Playback Controls ---------- */
function step(){
  if(!playing)return;
  t+=dt;
  if(t>=duration){playing=false; t=duration;}
  const progress=t/duration*100;
  progressEl.style.width=progress+'%';
  plotOrbit(t/duration);
  if(soundEnabled && osc) osc.frequency.setValueAtTime(150+300*(t/duration), audioCtx.currentTime);
  if(t<duration) requestAnimationFrame(step);
}

document.getElementById('playPause').onclick=()=>{
  playing=!playing;
  document.getElementById('playPause').textContent=playing?'‚è∏':'‚ñ∂Ô∏è';
  if(playing) step();
};
document.getElementById('restart').onclick=()=>{
  t=0; progressEl.style.width='0%'; playing=false;
  document.getElementById('playPause').textContent='‚ñ∂Ô∏è';
  plotOrbit(0);
};
document.getElementById('soundToggle').onclick=()=>{
  if(!soundEnabled){
    audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    osc=audioCtx.createOscillator();
    osc.type='sine';
    osc.frequency.setValueAtTime(150,audioCtx.currentTime);
    osc.connect(audioCtx.destination);
    osc.start();
    soundEnabled=true;
    document.getElementById('soundToggle').textContent='üîä Sound On';
  }else{
    osc.stop(); soundEnabled=false;
    document.getElementById('soundToggle').textContent='üîá Enable Sound';
  }
};

/* ---------- Simulation Setup ---------- */
function runSimulation(){
  const ev=document.getElementById('eventSelect').value;
  if(ev==='custom'){
    document.getElementById('customOptions').style.display='block';
  }else{
    document.getElementById('customOptions').style.display='none';
    const presets={gw150914:[36,29],gw170817:[1.4,1.4],gw190521:[85,66]};
    const [m1,m2]=presets[ev]||[30,30];
    const data=generateWave(m1,m2);
    plotWaveform(data);
    plotSpectrogram(data);
    plotOrbit(0);
  }
}

document.getElementById('runBtn').onclick=runSimulation;
document.getElementById('generateBtn').onclick=()=>{
  const m1=+document.getElementById('mass1').value;
  const m2=+document.getElementById('mass2').value;
  const data=generateWave(m1,m2);
  plotWaveform(data);
  plotSpectrogram(data);
  plotOrbit(0);
};

runSimulation(); // initial
</script>
</body>
</html>
