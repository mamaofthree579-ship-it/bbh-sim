<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBH Simulation</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background: #0a0a0f; color: #eee; }
  .tabs { display: flex; border-bottom: 1px solid #444; }
  .tab { padding: 10px 20px; cursor: pointer; }
  .tab.active { background: #222; }
  .content { display: none; padding: 20px; }
  .content.active { display: block; }
  canvas { display:block; margin:auto; background:#000; border:1px solid #444; }
  .button { padding:5px 10px; margin:5px; cursor:pointer; background:#222; color:#eee; border:none; }
  .mini-window { background:#111; border:1px solid #555; padding:10px; margin:5px; display:none; position:relative; }
  .close-btn { position:absolute; top:2px; right:5px; cursor:pointer; color:#f55; }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <div class="tab active" data-tab="overview">Overview</div>
  <div class="tab" data-tab="events">Events</div>
  <div class="tab" data-tab="advanced">Advanced Physics</div>
</div>

<!-- Overview Content -->
<div class="content active" id="overview">
  <h2>Black Hole Overview</h2>
  <p>Single black hole visual. No chirp audio here.</p>
  <canvas id="bhCanvas" width="400" height="400"></canvas>
</div>

<!-- Events Content -->
<div class="content" id="events">
  <h2>Binary Black Hole Events</h2>
  <label for="eventSelect">Select Event:</label>
  <select id="eventSelect">
    <option value="GW150914">GW150914</option>
    <option value="GW151226">GW151226</option>
    <option value="GW170104">GW170104</option>
  </select>
  <button class="button" id="generateEvent">Generate</button>

  <div>
    <h3>Orbit Visual</h3>
    <canvas id="orbitCanvas" width="400" height="400"></canvas>
  </div>

  <div>
    <h3>Chirp Waveform</h3>
    <canvas id="chirpCanvas" width="400" height="150"></canvas>
    <audio id="chirpAudio" controls></audio>
  </div>

  <div>
    <h3>Spectrogram</h3>
    <canvas id="spectrogramCanvas" width="400" height="150"></canvas>
  </div>

  <div>
    <h3>Custom Simulation</h3>
    <label for="customMass1">Mass 1:</label>
    <input type="number" id="customMass1" value="30">
    <label for="customMass2">Mass 2:</label>
    <input type="number" id="customMass2" value="30">
    <button class="button" id="runCustom">Run Simulation</button>
  </div>
</div>

<!-- Advanced Physics Content -->
<div class="content" id="advanced">
  <h2>Advanced Physics Calculators</h2>
  <button class="button" onclick="toggleMini('ap1')">Show GR Formulas</button>
  <div class="mini-window" id="ap1">
    <span class="close-btn" onclick="toggleMini('ap1')">×</span>
    <pre>
// Schwarzschild radius
r_s = 2GM/c^2
// Chirp mass
M_chirp = (M1*M2)^(3/5)/(M1+M2)^(1/5)
...
    </pre>
  </div>
</div>

<script>
// Tab functionality
const tabs = document.querySelectorAll('.tab');
const contents = document.querySelectorAll('.content');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    contents.forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

// Mini window toggle
function toggleMini(id) {
  const w = document.getElementById(id);
  w.style.display = (w.style.display === 'block') ? 'none' : 'block';
}

// --- Overview Black Hole Visual ---
const bhCanvas = document.getElementById('bhCanvas');
const bhCtx = bhCanvas.getContext('2d');
function drawBH() {
  bhCtx.clearRect(0,0,bhCanvas.width,bhCanvas.height);
  const cx = bhCanvas.width/2, cy = bhCanvas.height/2;
  const radius = 80;
  bhCtx.fillStyle = 'radial-gradient(circle, #000, #111)';
  bhCtx.beginPath();
  bhCtx.arc(cx,cy,radius,0,2*Math.PI);
  bhCtx.fill();
  requestAnimationFrame(drawBH);
}
drawBH();

// --- Event Visuals ---
const orbitCanvas = document.getElementById('orbitCanvas');
const orbitCtx = orbitCanvas.getContext('2d');
const chirpCanvas = document.getElementById('chirpCanvas');
const chirpCtx = chirpCanvas.getContext('2d');
const spectrogramCanvas = document.getElementById('spectrogramCanvas');
const spectrogramCtx = spectrogramCanvas.getContext('2d');
const chirpAudio = document.getElementById('chirpAudio');

function generateEventVisuals(eventName) {
  // Mock: orbit
  orbitCtx.clearRect(0,0,orbitCanvas.width,orbitCanvas.height);
  orbitCtx.fillStyle = 'orange';
  orbitCtx.beginPath();
  orbitCtx.arc(200 + 50*Math.sin(Date.now()/500), 200 + 50*Math.cos(Date.now()/500), 20,0,2*Math.PI);
  orbitCtx.fill();
  orbitCtx.fillStyle = 'blue';
  orbitCtx.beginPath();
  orbitCtx.arc(200 + 50*Math.sin(Date.now()/600+1), 200 + 50*Math.cos(Date.now()/600+1), 20,0,2*Math.PI);
  orbitCtx.fill();

  // Mock: chirp
  chirpCtx.clearRect(0,0,chirpCanvas.width,chirpCanvas.height);
  chirpCtx.strokeStyle='lime';
  chirpCtx.beginPath();
  for(let i=0;i<chirpCanvas.width;i++){
    let y=75+50*Math.sin(0.02*i*(eventName.length));
    if(i===0) chirpCtx.moveTo(i,y); else chirpCtx.lineTo(i,y);
  }
  chirpCtx.stroke();

  // Mock audio: generate simple tone
  const AudioCtx = new (window.AudioContext||window.webkitAudioContext)();
  const o = AudioCtx.createOscillator();
  const g = AudioCtx.createGain();
  o.type='sine';
  o.frequency.value = 220 + eventName.length*50;
  o.connect(g); g.connect(AudioCtx.destination);
  o.start(); o.stop(AudioCtx.currentTime+0.5);
  chirpAudio.src = ''; // placeholder; real audio would be loaded here

  // Spectrogram mock
  spectrogramCtx.fillStyle='#000'; spectrogramCtx.fillRect(0,0,400,150);
  for(let i=0;i<400;i+=5){
    for(let j=0;j<150;j+=5){
      spectrogramCtx.fillStyle=`rgb(${i%255},${j%255},${(i+j)%255})`;
      spectrogramCtx.fillRect(i,j,5,5);
    }
  }
}

// Event selection
document.getElementById('generateEvent').addEventListener('click', ()=>{
  const ev = document.getElementById('eventSelect').value;
  generateEventVisuals(ev);
});

// Custom simulation button (mock)
document.getElementById('runCustom').addEventListener('click', ()=>{
  const m1 = parseFloat(document.getElementById('customMass1').value);
  const m2 = parseFloat(document.getElementById('customMass2').value);
  alert(`Running custom simulation for masses ${m1} and ${m2} M☉ (mock)`);
});
</script>
</body>
</html>
