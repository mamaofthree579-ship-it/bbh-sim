<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BBH Simulator ‚Äî Overview & Events</title>
<style>
:root{
  --bg:#05000a; --panel:#1a001f; --accent:#8000ff; --muted:#33003d; --text:#e5ccff;
}
body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);}
.tabs{display:flex;background:var(--panel);border-bottom:2px solid var(--muted);}
.tabButton{flex:1;padding:12px;cursor:pointer;background:transparent;border:0;color:var(--text);font-weight:700;}
.tabButton.active{background:var(--accent);color:#fff;}
.container{padding:18px;}
canvas{display:block;margin:12px auto;border-radius:8px;background:radial-gradient(circle at center,#14001a 0%, #05000a 100%);box-shadow:0 6px 18px rgba(0,0,0,0.6);}
.panel{background:rgba(30,0,40,0.6);padding:10px;border-radius:8px;border:1px solid var(--muted);max-width:920px;margin:12px auto;}
.btn{background:var(--accent);border-radius:6px;color:white;padding:8px 12px;border:0;cursor:pointer;}
.btn.secondary{background:#444;}
.small{font-size:0.9rem;color:#d6c7ff;}
.muted{color:#bdaeff;}
#status{font-size:0.9rem;color:#ffd;}
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <button class="tabButton active" data-tab="overviewTab">Overview</button>
  <button class="tabButton" data-tab="eventsTab">Events</button>
</div>

<!-- Overview -->
<div id="overviewTab" class="container tabContent" style="display:block;">
  <h2>üåå Black Hole Overview</h2>
  <div class="panel">
    <p class="small">A rotating black hole with an accretion disk. Stars are masked so none appear inside the black hole.</p>
    <canvas id="bhCanvas" width="900" height="420"></canvas>
  </div>
</div>

<!-- Events -->
<div id="eventsTab" class="container tabContent" style="display:none;">
  <h2>üí´ Gravitational-Wave Events</h2>
  <div class="panel">
    <div>
      <label for="eventSelect">Event</label>
      <select id="eventSelect"></select>
      <button id="runCustomBtn" class="btn">Run Custom</button>
      <button id="resetBtn" class="btn secondary">Reset Simulator</button>
      <span id="status">Audio: <span id="audioState">idle</span></span>
    </div>

    <div>
      <label>M‚ÇÅ (M‚òâ)</label><input id="m1Input" type="number" value="30" step="0.1" min="1">
      <label>M‚ÇÇ (M‚òâ)</label><input id="m2Input" type="number" value="30" step="0.1" min="1">
      <label>Spin a*</label><input id="spinInput" type="range" min="0" max="1" step="0.01" value="0.5">
      <span id="spinVal" class="muted">0.50</span>
    </div>

    <canvas id="orbitCanvas" width="900" height="380"></canvas>
    <canvas id="chirpCanvas" width="900" height="160"></canvas>
    <div>
      <button id="playChirpBtn" class="btn">üîä Play Chirp</button>
      <button id="stopChirpBtn" class="btn secondary">‚èπ Stop</button>
    </div>

    <div id="eventInfo" class="panel">
      <strong>Event Info</strong>
      <p id="eventDescription" class="small muted">‚Äî</p>
      <table style="width:100%;color:var(--text)">
        <tr><td class="small muted">Chirp mass</td><td id="chirpMass" style="text-align:right">‚Äî</td></tr>
        <tr><td class="small muted">Freq range</td><td id="freqRange" style="text-align:right">‚Äî</td></tr>
        <tr><td class="small muted">Estimated h</td><td id="gwStrain" style="text-align:right">‚Äî</td></tr>
        <tr><td class="small muted">Distance est.</td><td id="distance" style="text-align:right">‚Äî</td></tr>
      </table>
    </div>
  </div>
</div>

<script>
// Tab switching
document.querySelectorAll('.tabButton').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tabButton').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.tabContent').forEach(c=>c.style.display='none');
    document.getElementById(btn.dataset.tab).style.display='block';
  });
});

// Overview starfield + black hole
const bhCanvas=document.getElementById('bhCanvas');
const ctx=bhCanvas.getContext('2d');
const stars=[...Array(160)].map(()=>({x:Math.random()*bhCanvas.width,y:Math.random()*bhCanvas.height,r:Math.random()*1.2+0.5,phi:Math.random()*Math.PI*2}));
function drawOverview(){
  const cx=bhCanvas.width/2,cy=bhCanvas.height/2,r=70;
  ctx.clearRect(0,0,bhCanvas.width,bhCanvas.height);
  const grad=ctx.createRadialGradient(cx,cy,5,cx,cy,250);
  grad.addColorStop(0,'#0a0012'); grad.addColorStop(1,'#020006');
  ctx.fillStyle=grad; ctx.fillRect(0,0,bhCanvas.width,bhCanvas.height);
  for(const s of stars){
    s.phi+=0.02;
    const dist=Math.hypot(s.x-cx,s.y-cy);
    if(dist>r+15){
      ctx.beginPath();
      ctx.fillStyle=`rgba(255,255,255,${0.5+0.5*Math.sin(s.phi)})`;
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();
    }
  }
  for(let i=0;i<80;i++){
    ctx.beginPath();
    ctx.arc(cx,cy,r+i,0,Math.PI*2);
    ctx.strokeStyle=`rgba(160,40,200,${0.005})`;ctx.stroke();
  }
  ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.fillStyle='black';ctx.fill();
  requestAnimationFrame(drawOverview);
}
drawOverview();

// Events section
const eventSelect=document.getElementById('eventSelect');
const eventsDB={
  "GW150914":{m1:36,m2:29,spin:0.3,desc:"GW150914 ‚Äî first detection (2015): 36+29 M‚òâ."},
  "GW170104":{m1:31,m2:19,spin:0.45,desc:"GW170104 ‚Äî 31+19 M‚òâ (2017)."},
  "Custom":{m1:30,m2:30,spin:0.5,desc:"Custom system."}
};
for(const k in eventsDB){
  const opt=document.createElement('option');
  opt.value=k;opt.textContent=k;eventSelect.appendChild(opt);
}

const orbitCanvas=document.getElementById('orbitCanvas');
const octx=orbitCanvas.getContext('2d');
let orbitAngle=0,trails1=[],trails2=[];
function drawOrbit(m1,m2,spin){
  octx.clearRect(0,0,orbitCanvas.width,orbitCanvas.height);
  const cx=orbitCanvas.width/2,cy=orbitCanvas.height/2;
  const r1=80,r2=160;
  const x1=cx+Math.cos(orbitAngle)*r1,y1=cy+Math.sin(orbitAngle)*r1;
  const x2=cx-Math.cos(orbitAngle)*r2,y2=cy-Math.sin(orbitAngle)*r2;
  trails1.push({x:x1,y:y1}); trails2.push({x:x2,y:y2});
  if(trails1.length>100) trails1.shift(); if(trails2.length>100) trails2.shift();
  octx.fillStyle='#030008';octx.fillRect(0,0,orbitCanvas.width,orbitCanvas.height);
  for(let i=0;i<trails1.length;i++){
    octx.beginPath();octx.arc(trails1[i].x,trails1[i].y,2,0,Math.PI*2);
    octx.fillStyle=`rgba(255,120,255,${i/trails1.length})`;octx.fill();
  }
  for(let i=0;i<trails2.length;i++){
    octx.beginPath();octx.arc(trails2[i].x,trails2[i].y,3,0,Math.PI*2);
    octx.fillStyle=`rgba(80,220,255,${i/trails2.length})`;octx.fill();
  }
  octx.beginPath();octx.arc(x1,y1,12,0,Math.PI*2);octx.fillStyle='#ff66ff';octx.fill();
  octx.beginPath();octx.arc(x2,y2,16,0,Math.PI*2);octx.fillStyle='#00ccff';octx.fill();
  orbitAngle+=0.018+spin*0.01;
  requestAnimationFrame(()=>drawOrbit(m1,m2,spin));
}
drawOrbit(30,30,0.5);

// Chirp waveform + audio
const chirpCanvas=document.getElementById('chirpCanvas');
const cctx=chirpCanvas.getContext('2d');
let waveform=[];
function generateWaveform(m1,m2,spin){
  const N=800;waveform=[];
  for(let i=0;i<N;i++){
    const t=i/N,amp=Math.pow(t,2)*Math.exp(-1.5*(1-t));
    const f=20+(300*t)+(spin*50);waveform.push(amp*Math.sin(f*t));
  }
  drawChirp(-1);
}
function drawChirp(idx=-1){
  cctx.clearRect(0,0,chirpCanvas.width,chirpCanvas.height);
  cctx.beginPath();
  for(let i=0;i<waveform.length;i++){
    const x=i/waveform.length*chirpCanvas.width;
    const y=chirpCanvas.height/2 - waveform[i]*chirpCanvas.height*0.4;
    if(i===0)cctx.moveTo(x,y);else cctx.lineTo(x,y);
  }
  cctx.strokeStyle='#a64dff';cctx.stroke();
  if(idx>=0){
    const x=idx/waveform.length*chirpCanvas.width;
    cctx.beginPath();cctx.moveTo(x,0);cctx.lineTo(x,chirpCanvas.height);
    cctx.strokeStyle='red';cctx.stroke();
  }
}
let audioCtx,currentOsc,currentGain;
function playChirp(m1,m2,spin){
  if(!audioCtx)audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  if(audioCtx.state==='suspended')audioCtx.resume();
  stopChirp();
  const Mchirp=Math.pow((m1*m2)**(3/5)/(m1+m2)**(1/5),1);
  const f0=25+spin*20,f1=250+(Mchirp/30)*300;
  const dur=Math.max(0.6,3.0-(Mchirp/40));
  currentOsc=audioCtx.createOscillator();
  currentGain=audioCtx.createGain();
  currentOsc.type='sine';
  currentGain.gain.setValueAtTime(0.0001,audioCtx.currentTime);
  currentOsc.connect(currentGain);currentGain.connect(audioCtx.destination);
  currentOsc.frequency.setValueAtTime(f0,audioCtx.currentTime);
  currentOsc.frequency.linearRampToValueAtTime(f1,audioCtx.currentTime+dur);
  currentGain.gain.linearRampToValueAtTime(0.2,audioCtx.currentTime+0.02);
  currentGain.gain.linearRampToValueAtTime(0.0001,audioCtx.currentTime+dur);
  currentOsc.start(audioCtx.currentTime);
  currentOsc.stop(audioCtx.currentTime+dur);
  document.getElementById('audioState').textContent='playing';
}
function stopChirp(){
  if(currentOsc){try{currentOsc.stop();}catch(e){}}
  if(currentGain){currentGain.disconnect();}
  if(currentOsc){currentOsc.disconnect();}
  currentOsc=null;currentGain=null;
  document.getElementById('audioState').textContent='idle';
}

// UI hooks
const m1=document.getElementById('m1Input');
const m2=document.getElementById('m2Input');
const spin=document.getElementById('spinInput');
const spinVal=document.getElementById('spinVal');
spin.addEventListener('input',()=>spinVal.textContent=Number(spin.value).toFixed(2));

function loadEvent(key){
  const e=eventsDB[key];
  m1.value=e.m1;m2.value=e.m2;spin.value=e.spin;spinVal.textContent=e.spin.toFixed(2);
  document.getElementById('eventDescription').textContent=e.desc;
  generateWaveform(e.m1,e.m2,e.spin);
}
eventSelect.addEventListener('change',()=>loadEvent(eventSelect.value));
document.getElementById('runCustomBtn').addEventListener('click',()=>{
  generateWaveform(m1.value,m2.value,spin.value);
});
document.getElementById('resetBtn').addEventListener('click',()=>{
  trails1=[];trails2=[];orbitAngle=0;loadEvent('GW150914');
});
document.getElementById('playChirpBtn').addEventListener('click',()=>{
  playChirp(m1.value,m2.value,spin.value);
});
document.getElementById('stopChirpBtn').addEventListener('click',stopChirp);
loadEvent('GW150914');
</script>
</body>
</html>
