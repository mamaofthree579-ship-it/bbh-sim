<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BBH Simulator ‚Äî Overview & Events (Full)</title>
<style>
  :root{
    --bg:#05000a; --panel:#1a001f; --accent:#8000ff; --muted:#33003d; --text:#e5ccff;
  }
  body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;}
  .tabs{display:flex;background:var(--panel);border-bottom:2px solid var(--muted);}
  .tabButton{flex:1;padding:12px;cursor:pointer;background:transparent;border:0;color:var(--text);font-weight:700}
  .tabButton.active{background:var(--accent);color:#fff}
  .container{padding:18px}
  h2{margin:6px 0 10px;color:var(--text)}
  canvas{display:block;margin:12px auto;border-radius:8px;background:radial-gradient(circle at center,#14001a 0%, #05000a 100%);box-shadow:0 6px 18px rgba(0,0,0,0.6);}
  label,input,select,button,textarea{margin:6px 6px 6px 0;padding:8px;border-radius:6px;border:none}
  .panel{background:rgba(30,0,40,0.6);padding:12px;border-radius:10px;border:1px solid var(--muted);max-width:1180px;margin:12px auto}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .small{font-size:0.9rem;color:#d6c7ff}
  .muted{color:#bdaeff}
  .btn{background:var(--accent);border-radius:6px;color:white;padding:8px 12px;border:0;cursor:pointer}
  .btn.secondary{background:#444}
  .legend{display:flex;gap:16px;align-items:center;justify-content:center;margin-top:8px;color:var(--text);font-size:0.95rem}
  .swatch{width:18px;height:10px;border-radius:4px;display:inline-block;margin-right:6px;vertical-align:middle;cursor:pointer; border:1px solid rgba(255,255,255,0.06)}
  .tooltip { position: absolute; background: rgba(20,10,30,0.95); color: #fff; padding:8px; border-radius:6px; border:1px solid rgba(120,90,200,0.25); max-width:420px; font-size:0.95rem; display:none; z-index:1000; }
  pre { background:#070018; padding:8px; border-radius:6px; overflow:auto; color:#f0f0ff; }
  table { width:100%; border-collapse:collapse; }
  table td, table th { padding:6px; border-bottom:1px solid rgba(255,255,255,0.04); color:var(--text) }
  .smallMuted { font-size:0.85rem; color:#cfc3ff; margin-top:6px; }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <button class="tabButton active" data-tab="overviewTab">Overview</button>
  <button class="tabButton" data-tab="eventsTab">Events</button>
  <button class="tabButton" data-tab="comparisonTab">Event Comparison</button>
  <button class="tabButton" data-tab="calculatorsTab">Calculators</button>
</div>

<!-- Overview Tab -->
<div id="overviewTab" class="container tabContent" style="display:block">
  <h2>üåå Black Hole Overview</h2>
  <div class="panel">
    <p class="small">Sagittarius A* visualization (rotating hotspot + small trail). Adjust sliders below to control motion.</p>
    <canvas id="bhCanvas" width="920" height="420"></canvas>
    <div class="row">
      <label>Hotspot speed</label>
      <input id="hotspotSpeed" type="range" min="0.01" max="0.08" step="0.005" value="0.026" style="width:180px">
      <label>Trail length</label>
      <input id="trailLength" type="range" min="2" max="20" step="1" value="8" style="width:160px">
      <button id="resetOverview" class="btn secondary">Reset</button>
    </div>
    <div class="legend" aria-hidden="true">
      <div data-tooltip="eh"><span class="swatch" style="background:rgba(140,80,255,0.35);"></span>Event Horizon</div>
      <div data-tooltip="ad"><span class="swatch" style="background:rgba(255,180,80,0.22);"></span>Accretion Disk</div>
      <div data-tooltip="jet"><span class="swatch" style="background:rgba(120,200,255,0.18);"></span>Relativistic Jet</div>
    </div>
  </div>
</div>

<!-- Events Tab -->
<div id="eventsTab" class="container tabContent" style="display:none">
  <h2>üí´ Gravitational-Wave Events</h2>
  <div class="panel">
    <div class="row">
      <label for="eventSelect">Event</label>
      <select id="eventSelect"></select>
      <button id="runSimBtn" class="btn">Run Simulation</button>
      <button id="resetBtn" class="btn secondary">Reset</button>
      <button id="exportBtn" class="btn secondary" title="Export parameters & waveform">‚¨á Export JSON</button>
      <div style="margin-left:auto" id="audioState">Audio: <span class="muted">idle</span></div>
    </div>

    <div class="row" style="margin-top:8px">
      <label>M‚ÇÅ (M‚òâ)</label><input id="m1Input" type="number" value="30" step="0.1" min="1">
      <label>M‚ÇÇ (M‚òâ)</label><input id="m2Input" type="number" value="30" step="0.1" min="1">
      <label>Spin a*</label><input id="spinInput" type="range" min="0" max="1" step="0.01" value="0.5" style="width:160px">
      <span id="spinVal" class="muted">0.50</span>
      <label style="margin-left:8px">Separation (M)</label><input id="sepInput" type="number" value="12" step="1" style="width:70px">
    </div>

    <canvas id="orbitCanvas" width="920" height="360"></canvas>

    <div class="row" style="margin-top:8px">
      <div style="flex:1">
        <canvas id="chirpCanvas" width="920" height="180"></canvas>
        <div style="margin-top:6px">
          <button id="playChirpBtn" class="btn">üîä Play Chirp</button>
          <button id="stopChirpBtn" class="btn secondary">‚èπ Stop</button>
          <span class="muted" style="margin-left:12px">Playhead shown on chirp canvas when audio playing.</span>
        </div>
      </div>

      <div style="width:360px;margin-left:16px">
        <div style="background:rgba(10,0,20,0.6);padding:10px;border-radius:8px;border:1px solid var(--muted)">
          <strong>Event Info</strong>
          <p id="eventDescription" class="small muted">‚Äî</p>
          <table>
            <tr><td class="small muted">Chirp mass</td><td id="chirpMass" style="text-align:right">‚Äî</td></tr>
            <tr><td class="small muted">Freq range</td><td id="freqRange" style="text-align:right">‚Äî</td></tr>
            <tr><td class="small muted">Estimated h</td><td id="gwStrain" style="text-align:right">‚Äî</td></tr>
            <tr><td class="small muted">Distance est.</td><td id="distance" style="text-align:right">‚Äî</td></tr>
            <tr><td class="small muted">Spin a*</td><td id="spinOut" style="text-align:right">‚Äî</td></tr>
            <tr><td class="small muted">Energy rad.</td><td id="energyOut" style="text-align:right">‚Äî</td></tr>
          </table>
        </div>
      </div>
    </div>

    <div style="margin-top:12px">
      <div style="background:rgba(20,0,40,0.5);padding:10px;border-radius:8px;border:1px solid var(--muted)">
        <strong>Scientific Summary (visual)</strong>
        <h4 class="small muted">Chirp Amplitude</h4>
        <canvas id="amplitudeCanvas" width="920" height="110"></canvas>
        <h4 class="small muted">Energy Loss</h4>
        <canvas id="energyCanvas" width="920" height="110"></canvas>
        <h4 class="small muted">Frequency evolution</h4>
        <canvas id="freqCanvas" width="920" height="110"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Event Comparison Tab -->
<div id="comparisonTab" class="container tabContent" style="display:none">
  <h2>üîÅ Event Comparison</h2>
  <div class="panel" style="display:flex;gap:12px;flex-wrap:wrap;justify-content:space-between;">
    <div style="flex:1; min-width:440px;">
      <strong>Event 1</strong>
      <select id="compEvent1"></select>
      <canvas id="compOrbit1" width="440" height="300"></canvas>
      <canvas id="compChirp1" width="440" height="150"></canvas>
    </div>
    <div style="flex:1; min-width:440px;">
      <strong>Event 2</strong>
      <select id="compEvent2"></select>
      <canvas id="compOrbit2" width="440" height="300"></canvas>
      <canvas id="compChirp2" width="440" height="150"></canvas>
    </div>
  </div>
</div>

<!-- Calculators Tab -->
<div id="calculatorsTab" class="container tabContent" style="display:none">
  <h2>üßÆ Calculators</h2>
  <div class="panel" id="sgrCalcPanel">
    <strong>Sagittarius A* ‚Äî quick calculator</strong>
    <div class="row" style="margin-top:8px">
      <label>Radius r (m)</label>
      <input id="radiusInput" type="number" value="7.8e17" style="width:260px">
      <label>Dark Matter œÅ_DM (kg/m¬≥)</label>
      <input id="densityInput" type="number" value="1e-21" style="width:220px">
      <button id="runCalcBtn" class="btn">Run</button>
    </div>
    <div id="calcResults" style="margin-top:8px;color:#ffd;"></div>
  </div>
</div>

<!-- Tooltip -->
<div id="tooltip" class="tooltip" role="dialog" aria-hidden="true"></div>

<script>
/* -----------------------
   Tabs handling
----------------------- */
document.querySelectorAll('.tabButton').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tabButton').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.tabContent').forEach(c=>c.style.display='none');
    document.getElementById(btn.dataset.tab).style.display='block';
    tooltip.style.display='none';
  });
});

/* -----------------------
   Overview BH Visual
----------------------- */
const bhCanvas=document.getElementById('bhCanvas');
const bhCtx=bhCanvas.getContext('2d');
const bhW=bhCanvas.width, bhH=bhCanvas.height;
const bhCx=bhW/2, bhCy=bhH/2;
const horizonR=70;
const stars=Array.from({length:160}, ()=>({x:Math.random()*bhW,y:Math.random()*bhH,r:0.5+Math.random()*1.1,phi:Math.random()*Math.PI*2,vx:(Math.random()-0.5)*0.06}));
let bhHotAngle=0, trailLen=8, hotspotSpeed=0.026;

function drawOverview(){
  bhCtx.clearRect(0,0,bhW,bhH);
  const g = bhCtx.createRadialGradient(bhCx,bhCy,10,bhCx,bhCy,300);
  g.addColorStop(0,'#070g.addColorStop(0,'#070010');
  g.addColorStop(1,'#05000a');
  bhCtx.fillStyle = g;
  bhCtx.fillRect(0,0,bhW,bhH);

  // Draw stars
  stars.forEach(s=>{
    s.x += s.vx;
    if(s.x<0) s.x=bhW;
    if(s.x>bhW) s.x=0;
    bhCtx.beginPath();
    bhCtx.arc(s.x,s.y,s.r,0,Math.PI*2);
    bhCtx.fillStyle='#fff';
    bhCtx.fill();
  });

  // Draw accretion disk
  bhCtx.beginPath();
  bhCtx.arc(bhCx,bhCy,horizonR*1.6,0,Math.PI*2);
  bhCtx.strokeStyle='rgba(255,180,80,0.22)';
  bhCtx.lineWidth=6;
  bhCtx.stroke();

  // Draw hotspot + trail
  const trailPoints=[];
  for(let i=0;i<trailLen;i++){
    const angle = bhHotAngle - i*0.08;
    trailPoints.push({
      x: bhCx + Math.cos(angle)*(horizonR*1.6),
      y: bhCy + Math.sin(angle)*(horizonR*1.6)
    });
  }
  trailPoints.forEach((p,i)=>{
    bhCtx.beginPath();
    bhCtx.arc(p.x,p.y,3*(1-i/trailLen),0,Math.PI*2);
    bhCtx.fillStyle=`rgba(255,140,220,${1-i/trailLen})`;
    bhCtx.fill();
  });

  // Draw black hole
  bhCtx.beginPath();
  bhCtx.arc(bhCx,bhCy,horizonR,0,Math.PI*2);
  bhCtx.fillStyle='black';
  bhCtx.fill();

  // Draw jet
  bhCtx.beginPath();
  bhCtx.moveTo(bhCx,bhCy-horizonR);
  bhCtx.lineTo(bhCx,bhCy-horizonR-80);
  bhCtx.strokeStyle='rgba(120,200,255,0.18)';
  bhCtx.lineWidth=6;
  bhCtx.stroke();

  bhHotAngle += hotspotSpeed;
  requestAnimationFrame(drawOverview);
}
drawOverview();

/* -----------------------
   Sliders
----------------------- */
document.getElementById('hotspotSpeed').addEventListener('input', e=>hotspotSpeed=parseFloat(e.target.value));
document.getElementById('trailLength').addEventListener('input', e=>trailLen=parseInt(e.target.value));
document.getElementById('resetOverview').addEventListener('click', ()=>{
  hotspotSpeed=0.026; trailLen=8;
  document.getElementById('hotspotSpeed').value=hotspotSpeed;
  document.getElementById('trailLength').value=trailLen;
});

/* -----------------------
   Event Tab Setup
----------------------- */
const events = [
  {name:'GW150914', m1:36, m2:29, spin:0.3, desc:'First detected BBH merger', chirpMass:30, freq:[35,250], h:'1e-21', dist:'410 Mpc', energy:'3 M‚òâc¬≤'},
  {name:'GW170104', m1:31, m2:19, spin:0.2, desc:'Second high-mass BBH merger', chirpMass:21.8, freq:[40,350], h:'7e-22', dist:'880 Mpc', energy:'2.5 M‚òâc¬≤'},
  {name:'GW190521', m1:85, m2:66, spin:0.7, desc:'Largest mass BBH detected', chirpMass:65, freq:[10,70], h:'3e-21', dist:'5 Gpc', energy:'8 M‚òâc¬≤'}
];

const eventSelect=document.getElementById('eventSelect');
const compEvent1=document.getElementById('compEvent1');
const compEvent2=document.getElementById('compEvent2');
events.forEach(ev=>{
  const opt=document.createElement('option'); opt.textContent=ev.name; eventSelect.appendChild(opt);
  const opt1=document.createElement('option'); opt1.textContent=ev.name; compEvent1.appendChild(opt1);
  const opt2=document.createElement('option'); opt2.textContent=ev.name; compEvent2.appendChild(opt2);
});

function loadEvent(ev){
  document.getElementById('m1Input').value=ev.m1;
  document.getElementById('m2Input').value=ev.m2;
  document.getElementById('spinInput').value=ev.spin;
  document.getElementById('spinVal').textContent=ev.spin.toFixed(2);
  document.getElementById('sepInput').value=12;

  document.getElementById('eventDescription').textContent=ev.desc;
  document.getElementById('chirpMass').textContent=ev.chirpMass;
  document.getElementById('freqRange').textContent=`${ev.freq[0]}‚Äì${ev.freq[1]} Hz`;
  document.getElementById('gwStrain').textContent=ev.h;
  document.getElementById('distance').textContent=ev.dist;
  document.getElementById('spinOut').textContent=ev.spin;
  document.getElementById('energyOut').textContent=ev.energy;
}

eventSelect.addEventListener('change', ()=>loadEvent(events[eventSelect.selectedIndex]));
loadEvent(events[0]);

document.getElementById('spinInput').addEventListener('input', e=>{
  document.getElementById('spinVal').textContent=parseFloat(e.target.value).toFixed(2);
});

/* -----------------------
   Calculator
----------------------- */
document.getElementById('runCalcBtn').addEventListener('click', ()=>{
  const r=parseFloat(document.getElementById('radiusInput').value);
  const rho=parseFloat(document.getElementById('densityInput').value);
  const mass = 4*Math.PI*r*r*r*rho/3;
  document.getElementById('calcResults').textContent=`Approx. Enclosed Mass: ${mass.toExponential(3)} kg`;
});

/* -----------------------
   Tooltip (optional, hidden)
----------------------- */
const tooltip=document.getElementById('tooltip');
document.querySelectorAll('[data-tooltip]').forEach(el=>{
  el.addEventListener('mouseenter',e=>{
    tooltip.textContent=el.getAttribute('data-tooltip');
    tooltip.style.left=e.pageX+12+'px';
    tooltip.style.top=e.pageY+12+'px';
    tooltip.style.display='block';
  });
  el.addEventListener('mouseleave',()=>tooltip.style.display='none');
});
</script>
</body>
</html>
