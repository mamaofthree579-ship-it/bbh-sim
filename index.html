index.html:

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BBH Simulation Visualizer ‚Äî Orbit, Chirp & Spectrogram</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at top, #030316, #000);
    color: #e9f6ff;
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
  }
  header {
    background: rgba(255,255,255,0.04);
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,0.08);
  }
  header h1 {
    margin: 0;
    font-size: 1.2rem;
    color: #00d4ff;
  }
  .controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 10px;
    flex-wrap: wrap;
  }
  select, button, input {
    background: #0c0c14;
    border: 1px solid rgba(255,255,255,0.1);
    color: #e9f6ff;
    border-radius: 6px;
    padding: 8px;
  }
  button { cursor: pointer; }
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    gap: 14px;
  }
  .plot {
    width: 95%;
    max-width: 1000px;
    border-radius: 8px;
  }
  .custom-controls {
    width: 95%;
    max-width: 1000px;
    background: rgba(255,255,255,0.03);
    padding: 12px;
    border-radius: 8px;
  }
  .custom-controls label {
    display: inline-block;
    margin: 6px;
    font-size: 0.9rem;
  }
  .player {
    width: 95%;
    max-width: 1000px;
    background: rgba(255,255,255,0.03);
    padding: 10px;
    border-radius: 8px;
    margin-top: 6px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
  }
  .player button {
    background: transparent;
    border: none;
    color: #e9f6ff;
    font-size: 18px;
  }
  footer {
    text-align: center;
    color: #aaa;
    font-size: 0.85rem;
    padding: 14px;
  }
</style>
</head>
<body>

<header>
  <h1>üåÄ BBH Simulation Visualizer</h1>
  <div class="controls">
    <select id="presetSelect">
      <option value="GW150914">GW150914 (first BBH)</option>
      <option value="GW170104">GW170104</option>
      <option value="GW190521">GW190521</option>
      <option value="custom">Custom Simulation</option>
    </select>
    <button id="generateBtn">Generate</button>
  </div>
</header>

<main>
  <div id="mainPlot" class="plot" style="height:300px;"></div>
  <div id="specPlot" class="plot" style="height:220px;"></div>

  <div class="custom-controls" id="customControls" style="display:none;">
    <strong>Custom Simulation Parameters</strong><br>
    <label>m‚ÇÅ <input id="m1" type="number" value="36" min="1" style="width:70px"></label>
    <label>m‚ÇÇ <input id="m2" type="number" value="29" min="1" style="width:70px"></label>
    <label>spin‚ÇÅ <input id="s1" type="number" value="0.3" min="0" max="1" step="0.01" style="width:60px"></label>
    <label>spin‚ÇÇ <input id="s2" type="number" value="0.2" min="0" max="1" step="0.01" style="width:60px"></label>
    <label>sep <input id="sep" type="number" value="15" min="6" style="width:60px"></label>
    <button id="runCustom">Run</button>
  </div>

  <div id="orbitPlot" class="plot" style="height:420px;"></div>

  <div class="player">
    <button id="playPause">‚ñ∂Ô∏è</button>
    <button id="restart">üîÅ</button>
    <button id="soundToggle">üîá</button>
  </div>
</main>

<footer>
  ¬© Open BBH Visualizer ‚Ä¢ 3D Orbits, Chirp, and Spectrogram
</footer>

<script>
let state = { playing:false, audioEnabled:false, audioCtx:null, audioOsc:null, tIndex:0, sampleRate:1024 };
let tsData = null;

function generateChirp(m1,m2){
  const duration = 6;
  const N = Math.round(duration*state.sampleRate);
  const t=[], h=[], freq=[];
  const f0=30, f1=500;
  for(let i=0;i<N;i++){
    const tt=i/state.sampleRate;
    const tau=tt/duration;
    const f=f0+(f1-f0)*Math.pow(tau,3);
    freq.push(f);
    t.push(tt);
    const amp=Math.pow(tau,2)*Math.exp(-2*(1-tau));
    h.push(amp*Math.sin(2*Math.PI*f*tt));
  }
  return {t,h,freq};
}

function plotWaveform(ts){
  Plotly.newPlot('mainPlot', [{x:ts.t,y:ts.h,type:'scatter',mode:'lines',line:{color:'#00d4ff'}}],
    {title:'Gravitational Waveform',paper_bgcolor:'transparent',plot_bgcolor:'transparent',
     margin:{t:40,l:50,r:20,b:40}}, {displayModeBar:false});
}

function plotSpectrogram(ts){
  const w=128,hop=64,mags=[];
  for(let i=0;i+w<ts.h.length;i+=hop){
    const seg=ts.h.slice(i,i+w);
    mags.push(seg.map(v=>Math.abs(v)));
  }
  Plotly.newPlot('specPlot',[{z:mags,type:'heatmap',colorscale:'Viridis'}],
   {title:'Spectrogram',paper_bgcolor:'transparent',plot_bgcolor:'transparent',margin:{t:40,l:50,r:20,b:40}},
   {displayModeBar:false});
}

function plotOrbit(){
  const layout={scene:{xaxis:{visible:false},yaxis:{visible:false},zaxis:{visible:false}},
  margin:{t:0,l:0,r:0,b:0},paper_bgcolor:'transparent',plot_bgcolor:'transparent'};
  const data=[
    {x:[0.5],y:[0],z:[0],type:'scatter3d',mode:'markers',marker:{color:'#00d4ff',size:6},name:'BH1'},
    {x:[-0.5],y:[0],z:[0],type:'scatter3d',mode:'markers',marker:{color:'#ff2e8a',size:6},name:'BH2'}
  ];
  Plotly.newPlot('orbitPlot',data,layout,{displayModeBar:false});
}

function updateOrbit(i,ts){
  const theta=i*0.05;
  const r1=0.5*Math.cos(theta),r2=-0.5*Math.cos(theta);
  const y1=0.5*Math.sin(theta),y2=-0.5*Math.sin(theta);
  Plotly.restyle('orbitPlot',{'x':[[r1],[r2]],'y':[[y1],[y2]]},[0,1]);
}

function generateAndPlot(){
  const preset=document.getElementById('presetSelect').value;
  let m1=36,m2=29;
  if(preset==='GW170104'){m1=31;m2=19;}
  if(preset==='GW190521'){m1=85;m2=66;}
  if(preset==='custom'){
    document.getElementById('customControls').style.display='block';
    m1=+document.getElementById('m1').value;
    m2=+document.getElementById('m2').value;
  } else document.getElementById('customControls').style.display='none';
  tsData=generateChirp(m1,m2);
  plotWaveform(tsData);
  plotSpectrogram(tsData);
  plotOrbit();
}

function play(){
  if(!tsData)return;
  state.playing=true;
  if(state.audioEnabled&&!state.audioCtx){
    state.audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  }
  if(state.audioEnabled&&state.audioCtx){
    const osc=state.audioCtx.createOscillator();
    const gain=state.audioCtx.createGain();
    gain.gain.value=0.05;
    osc.type='sine';
    osc.connect(gain);gain.connect(state.audioCtx.destination);
    osc.start();
    state.audioOsc={osc,gain};
  }
  function step(){
    if(!state.playing)return;
    const i=state.tIndex;
    if(i>=tsData.t.length){pause();return;}
    if(state.audioEnabled&&state.audioOsc){
      const f=Math.min(1500,tsData.freq[i]*2);
      try{state.audioOsc.osc.frequency.setValueAtTime(f,state.audioCtx.currentTime);}catch(e){}
    }
    updateOrbit(i,tsData);
    state.tIndex++;
    requestAnimationFrame(step);
  }
  step();
}

function pause(){
  state.playing=false;
  if(state.audioOsc){
    try{state.audioOsc.osc.stop();}catch(e){}
    state.audioOsc=null;
  }
}

document.getElementById('generateBtn').onclick=generateAndPlot;
document.getElementById('runCustom').onclick=generateAndPlot;
document.getElementById('playPause').onclick=()=>{
  if(state.playing){pause();document.getElementById('playPause').textContent='‚ñ∂Ô∏è';}
  else{state.tIndex=0;play();document.getElementById('playPause').textContent='‚è∏';}
};
document.getElementById('restart').onclick=()=>{state.tIndex=0;pause();play();};
document.getElementById('soundToggle').onclick=()=>{
  state.audioEnabled=!state.audioEnabled;
  document.getElementById('soundToggle').textContent=state.audioEnabled?'üîä':'üîá';
};
generateAndPlot();
</script>
</body>
</html>
