<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Black Hole & Gravitational-Wave Simulator</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#05000a; color:white; overflow-x:hidden; }
  .tabs { display:flex; background:#1a001f; border-bottom:2px solid #33003d; }
  .tabButton { flex:1; padding:12px; cursor:pointer; background:#22002b; border:none; color:#e5ccff; font-weight:bold; transition:0.3s; }
  .tabButton:hover { background:#33003d; }
  .tabButton.active { background:#550066; color:white; }
  .tabContent { display:none; padding:20px; }
  canvas { border:1px solid #33003d; border-radius:8px; display:block; margin:15px auto; background:radial-gradient(circle at center, #14001a 0%, #05000a 100%); }
  button, select, input { margin:5px 0; padding:8px; border:none; border-radius:4px; }
  button { background:#8000ff; color:white; cursor:pointer; transition:0.3s; }
  button:hover { background:#a64dff; }
  #eventInfo, #scienceSummary { background:rgba(30,0,40,0.7); padding:10px; border-radius:8px; margin-top:10px; border:1px solid #33003d; }
  #scienceSummary table { width:100%; border-collapse:collapse; margin-top:5px; }
  #scienceSummary th, #scienceSummary td { text-align:left; padding:6px; border-bottom:1px solid #440055; color:#e5ccff; }
  h2,h3,h4 { color:#e5ccff; }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <button class="tabButton active" data-tab="overviewTab">Overview</button>
  <button class="tabButton" data-tab="eventsTab">Events</button>
</div>

<!-- Overview -->
<div id="overviewTab" class="tabContent" style="display:block;">
  <h2>üåå Black Hole Overview</h2>
  <p>Observe a rotating black hole surrounded by a glowing accretion disk and distant stars, warped by extreme gravity.</p>
  <canvas id="bhCanvas" width="800" height="400"></canvas>
</div>

<!-- Events -->
<div id="eventsTab" class="tabContent">
  <h2>üí´ Gravitational-Wave Events</h2>
  <label for="eventSelect">Select Event:</label>
  <select id="eventSelect"></select>
  <button id="runCustomBtn">Run Custom Simulation</button>
  <button id="resetBtn">Reset Simulation</button><br>

  <label>M‚ÇÅ (M‚òâ):</label><input id="m1Input" type="number" value="30" step="0.1">
  <label>M‚ÇÇ (M‚òâ):</label><input id="m2Input" type="number" value="30" step="0.1">
  <label>Spin (a*):</label><input id="spinInput" type="number" value="0.5" step="0.1" min="0" max="1"><br>
  
  <canvas id="orbitCanvas" width="700" height="400"></canvas>
  <canvas id="chirpCanvas" width="800" height="200"></canvas>
  <button id="playChirpBtn">üîä Play Chirp</button>

  <div id="eventInfo">
    <strong>Event Information:</strong>
    <p id="eventDescription"></p>
  </div>

  <div id="scienceSummary">
    <strong>Scientific Summary:</strong>
    <table>
      <tr><th>Parameter</th><th>Value</th></tr>
      <tr><td>Chirp Mass (‚Ñ≥)</td><td id="chirpMass">--</td></tr>
      <tr><td>Frequency Range (Hz)</td><td id="freqRange">--</td></tr>
      <tr><td>GW Strain (h)</td><td id="gwStrain">--</td></tr>
      <tr><td>Estimated Distance</td><td id="distance">--</td></tr>
    </table>
    <h4>Chirp Amplitude</h4>
    <canvas id="amplitudeCanvas" width="800" height="200"></canvas>
    <h4>Energy Loss</h4>
    <canvas id="energyCanvas" width="800" height="200"></canvas>
    <h4>Frequency Evolution</h4>
    <canvas id="freqCanvas" width="800" height="200"></canvas>
  </div>
</div>

<script>
// --- Tabs ---
const tabButtons=document.querySelectorAll('.tabButton');
const tabContents=document.querySelectorAll('.tabContent');
tabButtons.forEach(btn=>{
  btn.addEventListener('click',()=>{
    tabButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    tabContents.forEach(tc=>tc.style.display='none');
    document.getElementById(btn.dataset.tab).style.display='block';
  });
});

// --- Overview with masked stars ---
const bhCanvas=document.getElementById('bhCanvas');
const bhCtx=bhCanvas.getContext('2d');
const stars=Array.from({length:150},()=>({
  x:Math.random()*bhCanvas.width,
  y:Math.random()*bhCanvas.height,
  r:Math.random()*1.2,
  tw:Math.random()*2*Math.PI
}));
let bhAngle=0;
function drawBH(){
  bhCtx.clearRect(0,0,bhCanvas.width,bhCanvas.height);
  const cx=bhCanvas.width/2, cy=bhCanvas.height/2, rBH=70;
  // Stars (mask out inside the BH region)
  stars.forEach(s=>{
    s.tw+=0.05;
    const brightness=0.6+0.4*Math.sin(s.tw);
    if(Math.hypot(s.x-cx,s.y-cy)>rBH+5){
      bhCtx.beginPath();
      bhCtx.arc(s.x,s.y,s.r,0,2*Math.PI);
      bhCtx.fillStyle=`rgba(255,255,255,${brightness})`;
      bhCtx.fill();
    }
  });
  // Accretion disk glow
  const grad=bhCtx.createRadialGradient(cx,cy,10,cx,cy,200);
  grad.addColorStop(0,'#000');
  grad.addColorStop(1,'#33003d');
  bhCtx.fillStyle=grad;
  bhCtx.fillRect(0,0,bhCanvas.width,bhCanvas.height);
  // BH core
  bhCtx.beginPath();
  bhCtx.arc(cx,cy,rBH,0,2*Math.PI);
  bhCtx.fillStyle='black'; bhCtx.fill();
  // Orbiting hotspot
  const x=cx+Math.cos(bhAngle)*100, y=cy+Math.sin(bhAngle)*40;
  bhCtx.beginPath();
  bhCtx.arc(x,y,6,0,2*Math.PI);
  bhCtx.fillStyle='#ffcc99';
  bhCtx.fill();
  bhAngle+=0.03;
  requestAnimationFrame(drawBH);
}
drawBH();

// --- GW Events Setup ---
const gwEvents={
  "GW150914":{m1:36,m2:29,spin:0.3},
  "GW170104":{m1:31,m2:19,spin:0.5},
  "Custom":{m1:30,m2:30,spin:0.5}
};
const eventDescriptions={
  "GW150914":"First detection (2015): two black holes of 36 & 29 M‚òâ merged 1.3B ly away.",
  "GW170104":"Detected in 2017: 31 & 19 M‚òâ black holes merged ~3B ly away.",
  "Custom":"Custom system based on chosen parameters."
};
const eventSelect=document.getElementById('eventSelect');
for(let e in gwEvents){
  const opt=document.createElement('option');
  opt.value=e; opt.text=e; eventSelect.add(opt);
}

// --- Orbit Simulation with Trails ---
const orbitCanvas=document.getElementById('orbitCanvas');
const orbitCtx=orbitCanvas.getContext('2d');
let orbitAngle=0, orbitAnim;
const trail=[];

function drawOrbit(m1,m2,spin){
  cancelAnimationFrame(orbitAnim);
  trail.length=0;
  function animate(){
    const cx=orbitCanvas.width/2, cy=orbitCanvas.height/2;
    const r1=80, r2=160;
    const x1=cx+Math.cos(orbitAngle)*r1, y1=cy+Math.sin(orbitAngle)*r1;
    const x2=cx-Math.cos(orbitAngle)*r2, y2=cy-Math.sin(orbitAngle)*r2;

    trail.push({x1,y1,x2,y2});
    if(trail.length>100) trail.shift();

    orbitCtx.fillStyle='rgba(0,0,0,0.2)';
    orbitCtx.fillRect(0,0,orbitCanvas.width,orbitCanvas.height);

    // Trails
    orbitCtx.beginPath();
    trail.forEach((p,i)=>{
      orbitCtx.fillStyle=`rgba(255,100,255,${i/trail.length})`;
      orbitCtx.fillRect(p.x1,p.y1,2,2);
      orbitCtx.fillStyle=`rgba(100,255,255,${i/trail.length})`;
      orbitCtx.fillRect(p.x2,p.y2,2,2);
    });

    // Bodies
    orbitCtx.beginPath(); orbitCtx.arc(x1,y1,10,0,2*Math.PI); orbitCtx.fillStyle='#ff66ff'; orbitCtx.fill();
    orbitCtx.beginPath(); orbitCtx.arc(x2,y2,16,0,2*Math.PI); orbitCtx.fillStyle='#00ccff'; orbitCtx.fill();

    orbitAngle+=0.025+spin*0.01;
    orbitAnim=requestAnimationFrame(animate);
  }
  animate();
}

// --- Chirp Sound + Visual Pulse ---
const chirpCanvas=document.getElementById('chirpCanvas');
const chirpCtx=chirpCanvas.getContext('2d');

function playChirp(fStart,fEnd,duration){
  const audio=new (window.AudioContext||window.webkitAudioContext)();
  const osc=audio.createOscillator();
  const gain=audio.createGain();
  osc.connect(gain); gain.connect(audio.destination);
  osc.frequency.setValueAtTime(fStart,audio.currentTime);
  osc.frequency.exponentialRampToValueAtTime(fEnd,audio.currentTime+duration);
  gain.gain.setValueAtTime(0.2,audio.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.0001,audio.currentTime+duration);
  osc.start(); osc.stop(audio.currentTime+duration);

  // Visual waveform pulse
  const start=performance.now();
  function pulse(){
    const elapsed=(performance.now()-start)/1000;
    chirpCtx.clearRect(0,0,chirpCanvas.width,chirpCanvas.height);
    const progress=elapsed/duration;
    const freq=fStart*Math.pow(fEnd/fStart,progress);
    const amp=progress*1.2;
    for(let x=0;x<chirpCanvas.width;x++){
      const t=x/chirpCanvas.width;
      const y=chirpCanvas.height/2 + Math.sin(2*Math.PI*(freq/30)*t*progress*10)*amp*40;
      chirpCtx.fillStyle=`rgba(160,100,255,${0.5+0.5*Math.sin(t*10)})`;
      chirpCtx.fillRect(x,y,1,1);
    }
    if(elapsed<duration) requestAnimationFrame(pulse);
  }
  pulse();
}

// --- Graph Helper ---
function drawGraph(ctx,color,func){
  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
  ctx.beginPath();
  for(let i=0;i<ctx.canvas.width;i++){
    const t=i/ctx.canvas.width;
    const y=ctx.canvas.height/2 - func(t)*ctx.canvas.height/3;
    if(i===0) ctx.moveTo(i,y); else ctx.lineTo(i,y);
  }
  ctx.strokeStyle=color; ctx.lineWidth=2; ctx.stroke();
}

// --- Event Update ---
function updateEvent(eventKey){
  const ev=gwEvents[eventKey];
  document.getElementById('eventDescription').textContent=eventDescriptions[eventKey];
  drawOrbit(ev.m1,ev.m2,ev.spin);
  updateSummary(ev.m1,ev.m2);
  drawGraph(document.getElementById('amplitudeCanvas').getContext('2d'),'#a64dff',t=>Math.pow(t,3)*Math.sin(20*t*Math.PI*5));
  drawGraph(document.getElementById('energyCanvas').getContext('2d'),'#ff66ff',t=>Math.pow(t,2.5)*Math.exp(-3*t));
  drawGraph(document.getElementById('freqCanvas').getContext('2d'),'#00ccff',t=>t*t);
}

// --- Summary ---
function updateSummary(m1,m2){
  const chirpMass=Math.pow((m1*m2)**(3/5)/(m1+m2)**(1/5),1);
  document.getElementById('chirpMass').textContent=chirpMass.toFixed(2)+" M‚òâ";
  document.getElementById('freqRange').textContent="20‚Äì400 Hz";
  document.getElementById('gwStrain').textContent=(4e-21*(chirpMass/30)**(5/3)).toExponential(2);
  document.getElementById('distance').textContent=`${(chirpMass*40).toFixed(0)} million ly`;
}

// --- Custom Controls ---
document.getElementById('runCustomBtn').addEventListener('click',()=>{
  const m1=parseFloat(document.getElementById('m1Input').value);
  const m2=parseFloat(document.getElementById('m2Input').value);
  const spin=parseFloat(document.getElementById('spinInput').value);
  gwEvents["Custom"]={m1,m2,spin};
  eventDescriptions["Custom"]= `Custom system: m1=${m1} M‚òâ, m2=${m2} M‚òâ, spin=${spin}`;
  eventSelect.value="Custom";
  updateEvent("Custom");
});

document.getElementById('resetBtn').addEventListener('click',()=>updateEvent(eventSelect.value));

document.getElementById('playChirpBtn').addEventListener('click',()=>{
  const ev=gwEvents[eventSelect.value];
  const chirpMass=Math.pow((ev.m1*ev.m2)**(3/5)/(ev.m1+ev.m2)**(1/5),1);
  const fStart=30+ev.spin*10;
  const fEnd=300+(chirpMass/30)*300;
  const duration=Math.max(0.5,3-(chirpMass/40));
  playChirp(fStart,fEnd,duration);
});

eventSelect.addEventListener('change',()=>updateEvent(eventSelect.value));

// --- Init ---
updateEvent("GW150914");
</script>
</body>
</html>
