<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cosmic Event Simulator</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <style>
    body {
      margin: 0;
      background: radial-gradient(ellipse at center, #000010 0%, #000005 100%);
      color: #eee;
      font-family: "Segoe UI", sans-serif;
      overflow-x: hidden;
    }

    header {
      background: rgba(20, 20, 30, 0.9);
      text-align: center;
      padding: 1rem 0;
      font-size: 1.6rem;
      letter-spacing: 1px;
      box-shadow: 0 2px 10px #000;
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    nav button {
      background: #222;
      border: 1px solid #555;
      color: #eee;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }
    nav button:hover {
      background: #444;
      transform: scale(1.05);
    }

    .tab-content {
      display: none;
      padding: 2rem;
      animation: fadeIn 0.5s ease;
    }
    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .mini-window {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 30, 0.95);
      color: #eee;
      padding: 1.2rem;
      width: 90%;
      max-width: 800px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
      z-index: 1000;
      animation: popIn 0.4s ease;
    }

    @keyframes popIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    .close-btn {
      float: right;
      background: #c33;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    #threeContainer {
      width: 100%;
      height: 400px;
      background: radial-gradient(circle, #000010, #000000);
      border: 1px solid #222;
      border-radius: 12px;
      margin-top: 1rem;
    }

    #chirpGraph, #spectrogram {
      width: 100%;
      height: 300px;
      border-radius: 12px;
      margin-top: 1rem;
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
    }

    label {
      flex: 1 1 200px;
    }

    input, select, button {
      width: 100%;
      padding: 0.4rem;
      border-radius: 8px;
      border: 1px solid #444;
      background: #111;
      color: #eee;
    }

    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
      color: #777;
    }
  </style>
</head>
<body>
  <header>
    <div>üåå Cosmic Event Simulator</div>
    <nav>
      <button onclick="openTab('overview')">Overview</button>
      <button onclick="openTab('events')">Known Events</button>
      <button onclick="openTab('advanced')">Advanced Physics</button>
    </nav>
  </header>

  <!-- Overview -->
  <section id="overview" class="tab-content active">
    <h2>Black Hole Overview</h2>
    <p>
      Black holes warp spacetime so intensely that even light cannot escape.
      This simulator shows their interactions, gravitational waves, and energetic signatures.
    </p>

    <div id="threeContainer"></div>
    <button onclick="toggleChirp()">üîä Play Chirp</button>

    <div id="chirpGraph"></div>
    <div id="spectrogram"></div>
  </section>

  <!-- Events -->
  <section id="events" class="tab-content">
    <h2>Known Gravitational Wave Events</h2>
    <p>Select and replay real detections:</p>
    <select id="eventSelect" onchange="loadEvent()">
      <option value="">-- Select Event --</option>
      <option value="GW150914">GW150914</option>
      <option value="GW170817">GW170817</option>
    </select>
    <div id="eventGraph" style="width:100%; height:300px; margin-top:1rem;"></div>
  </section>

  <!-- Advanced Physics -->
  <section id="advanced" class="tab-content">
    <h2>Advanced Physics & Custom Simulations</h2>
    <p>Experiment with physical parameters or open the equations reference.</p>

    <div id="controls">
      <label>Mass 1 (M‚òâ): <input id="mass1" type="number" value="30"></label>
      <label>Mass 2 (M‚òâ): <input id="mass2" type="number" value="35"></label>
      <label>Distance (Mpc): <input id="distance" type="number" value="400"></label>
      <button onclick="runCustomSimulation()">Run Custom Simulation</button>
      <button onclick="openWindow('advancedPhysicsWindow')">üìò View Equations</button>
    </div>

    <div id="advanced3D" style="width:100%; height:400px; margin-top:1rem; border-radius:12px; background:#000;"></div>
  </section>

  <!-- Advanced Equations Mini Window -->
  <div id="advancedPhysicsWindow" class="mini-window">
    <button class="close-btn" onclick="closeWindow('advancedPhysicsWindow')">‚úñ</button>
    <header>Advanced Physics Equations</header>
    <div style="max-height:60vh; overflow-y:auto; font-size:0.9rem;">
      <p><strong>Chirp Mass:</strong> ùìú = (M‚ÇÅM‚ÇÇ)^{3/5} / (M‚ÇÅ+M‚ÇÇ)^{1/5}</p>
      <p><strong>GW Frequency Evolution:</strong> ·∫ãf = (96/5)œÄ^{8/3}(Gùìú)^{5/3}/c‚Åµ f^{11/3}</p>
      <p><strong>Strain Amplitude:</strong> h(f) ‚âà (4G^{5/3}/c‚Å¥)œÄ^{2/3} ùìú^{5/3}f^{2/3}/D</p>
      <p><strong>Neutrino Coupling:</strong> ŒîE_ŒΩ = Œ± ‚à´ Œ¶(r(t)) dt</p>
      <p><em>Adjust Œ± and Œ≤ coupling constants for energy transfer hypotheses.</em></p>
    </div>
  </div>

  <footer>
    <p>¬© 2025 Cosmic Event Simulator | If tabs freeze, press <strong>Ctrl + Shift + R</strong></p>
  </footer>

  <script>
    // --- Tab control ---
    function openTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
    }

    // --- Mini window control ---
    function openWindow(id) { document.getElementById(id).style.display = 'block'; }
    function closeWindow(id) { document.getElementById(id).style.display = 'none'; }

    // --- Chirp sound ---
    let chirpCtx, oscillator;
    function toggleChirp() {
      if (!chirpCtx) chirpCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (oscillator) { oscillator.stop(); oscillator = null; return; }
      oscillator = chirpCtx.createOscillator();
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(50, chirpCtx.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(400, chirpCtx.currentTime + 2);
      oscillator.connect(chirpCtx.destination);
      oscillator.start();
      oscillator.stop(chirpCtx.currentTime + 2);
    }

    // --- Chirp graph (mock waveform) ---
    function plotChirp() {
      const t = Array.from({length:1000}, (_,i)=>i/1000*2);
      const h = t.map(v => Math.sin(2*Math.PI*50*v*v)*Math.exp(-v));
      Plotly.newPlot('chirpGraph', [{x:t, y:h, mode:'lines', name:'h(t)'}],
        {title:'Mock Gravitational Wave Chirp', xaxis:{title:'Time (s)'}, yaxis:{title:'Strain'}});
    }

    // --- Spectrogram placeholder ---
    function plotSpectrogram() {
      const z = Array.from({length:40}, ()=>Array.from({length:40}, ()=>Math.random()));
      Plotly.newPlot('spectrogram', [{z, type:'heatmap', colorscale:'Viridis'}],
        {title:'Spectrogram', xaxis:{title:'Time'}, yaxis:{title:'Frequency'}});
    }

    // --- Event loader ---
    function loadEvent() {
      const event = document.getElementById('eventSelect').value;
      if (!event) return;
      const t = Array.from({length:1000}, (_,i)=>i/1000*4);
      const strain = t.map(v => Math.sin(2*Math.PI*30*v)*Math.exp(-v*0.5));
      Plotly.newPlot('eventGraph', [{x:t, y:strain, mode:'lines', name:event}],
        {title:`Simulated ${event} Strain`, xaxis:{title:'Time (s)'}, yaxis:{title:'Strain'}});
    }

    // --- Custom Simulation Placeholder ---
    function runCustomSimulation() {
      const m1 = parseFloat(document.getElementById('mass1').value);
      const m2 = parseFloat(document.getElementById('mass2').value);
      const D = parseFloat(document.getElementById('distance').value);
      alert(`Running simulation:\nMass1 = ${m1} M‚òâ\nMass2 = ${m2} M‚òâ\nDistance = ${D} Mpc`);
    }

    // --- Three.js binary inspiral ---
    function initThree() {
      const container = document.getElementById('threeContainer');
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer({antialias: true});
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      const stars = new THREE.BufferGeometry();
      const starCount = 500;
      const positions = [];
      for (let i=0; i<starCount; i++) {
        positions.push((Math.random()-0.5)*400, (Math.random()-0.5)*400, (Math.random()-0.5)*400);
      }
      stars.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
      const starMaterial = new THREE.PointsMaterial({color: 0xffffff, size: 0.8});
      const starField = new THREE.Points(stars, starMaterial);
      scene.add(starField);

      const orb1 = new THREE.Mesh(new THREE.SphereGeometry(3,32,32), new THREE.MeshBasicMaterial({color:0xffaa00}));
      const orb2 = new THREE.Mesh(new THREE.SphereGeometry(2.8,32,32), new THREE.MeshBasicMaterial({color:0x66ccff}));
      scene.add(orb1); scene.add(orb2);
      camera.position.z = 80;

      function animate(time) {
        requestAnimationFrame(animate);
        const t = time*0.001;
        const radius = 20;
        orb1.position.set(Math.cos(t)*radius, Math.sin(t)*radius, 0);
        orb2.position.set(-Math.cos(t)*radius, -Math.sin(t)*radius, 0);
        starField.rotation.y += 0.0005;
        renderer.render(scene, camera);
      }
      animate();
    }

    plotChirp();
    plotSpectrogram();
    initThree();
  </script>
</body>
</html>
