<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BBH Simulator ‚Äî Overview, Events & Advanced Physics</title>

<!-- MathJax for LaTeX -->
<script>
window.MathJax = { tex:{inlineMath:[['$','$'],['\ÓÄÅ','\ÓÄÅ']]}, svg:{fontCache:'global'} };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
  :root{
    --bg:#05000a; --panel:#1a001f; --accent:#8000ff; --muted:#33003d; --text:#e5ccff;
    --lightPanelBg: rgba(255,255,255,0.02);
    --panelBorder: rgba(200,180,255,0.06);
    --note: rgba(215,200,255,0.06);
  }
  body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text);}
  .tabs{display:flex;background:var(--panel);border-bottom:2px solid var(--muted);}
  .tabButton{flex:1;padding:12px;cursor:pointer;background:transparent;border:0;color:var(--text);font-weight:700}
  .tabButton.active{background:var(--accent);color:#fff}
  .container{padding:18px}
  h2{margin:6px 0 10px;color:var(--text)}
  canvas{display:block;margin:12px auto;border-radius:8px;background:radial-gradient(circle at center,#14001a 0%, #05000a 100%);box-shadow:0 6px 18px rgba(0,0,0,0.6);}
  label,input,select,button{margin:6px 6px 6px 0;padding:8px;border-radius:4px;border:none}
  input[type=range]{vertical-align:middle}
  .panel{background:rgba(30,0,40,0.6);padding:10px;border-radius:8px;border:1px solid var(--muted);max-width:1100px;margin:12px auto}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .small{font-size:0.9rem;color:#d6c7ff}
  .muted{color:#bdaeff}
  .btn{background:var(--accent);border-radius:6px;color:white;padding:8px 12px;border:0;cursor:pointer}
  .btn.secondary{background:#444}
  .legend{display:flex;gap:16px;align-items:center;justify-content:center;margin-top:8px;color:var(--text);font-size:0.95rem}
  .swatch{width:18px;height:10px;border-radius:4px;display:inline-block;margin-right:6px;vertical-align:middle;cursor:pointer; border:1px solid rgba(255,255,255,0.06)}
  .tooltip { position: absolute; background: rgba(20,10,30,0.95); color: #fff; padding:8px; border-radius:6px; border:1px solid rgba(120,90,200,0.25); max-width:360px; font-size:0.9rem; display:none; z-index:1000; }
  .tooltip .close { float:right; cursor:pointer; color:#ffd; margin-left:8px; font-weight:bold }
  pre { background:#070018; padding:8px; border-radius:6px; overflow:auto; color:#f0f0ff; }
  .collapsible { background: var(--lightPanelBg); border:1px solid var(--panelBorder); border-radius:6px; margin:10px 0; overflow:hidden; }
  .collapsible-header { padding:10px 12px; cursor:pointer; display:flex; align-items:center; gap:10px; }
  .collapsible-header h4 { margin:0; font-size:1rem; color:var(--text); }
  .collapsible-header .hint { font-size:0.85rem; color:#bfb0ff; margin-left:auto; }
  .collapsible-body { padding:10px 12px 14px 12px; display:none; border-top:1px solid rgba(255,255,255,0.02); }
  .collapsible-body p.note { background: var(--note); padding:8px; border-radius:6px; color:#efe8ff; margin-top:8px; font-size:0.92rem; }
  .collapsible.open .collapsible-body { display:block; }
  .collapsible.open .collapsible-header { background: rgba(255,255,255,0.01); }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <button class="tabButton active" data-tab="overviewTab">Overview</button>
  <button class="tabButton" data-tab="eventsTab">Events</button>
  <button class="tabButton" data-tab="advancedTab">Advanced Calculators</button>
</div>

<!-- Overview -->
<div id="overviewTab" class="container tabContent" style="display:block">
  <h2>üåå Black Hole Overview</h2>
  <div class="panel">
    <p class="small">A rotating black hole with accretion disk. Click a swatch to see the formula/explanation.</p>
    <canvas id="bhCanvas" width="920" height="420"></canvas>
    <div class="legend" aria-hidden="true">
      <div data-tooltip="eh"><span class="swatch" style="background:rgba(140,80,255,0.35);"></span>Event Horizon</div>
      <div data-tooltip="ad"><span class="swatch" style="background:rgba(255,180,80,0.22);"></span>Accretion Disk</div>
      <div data-tooltip="jet"><span class="swatch" style="background:rgba(120,200,255,0.18);"></span>Relativistic Jet</div>
    </div>
  </div>
</div>

<!-- Events Tab -->
<div id="eventsTab" class="container tabContent" style="display:none">
  <h2>üí´ Gravitational-Wave Events Simulator</h2>
  <div class="panel">
    <div class="row">
      <label for="eventSelect">Event</label>
      <select id="eventSelect"></select>
      <button id="runCustomBtn" class="btn">Run</button>
      <button id="resetBtn" class="btn secondary">Reset</button>
      <div style="margin-left:auto">Audio: <span id="audioState">idle</span></div>
    </div>
    <div class="row" style="margin-top:8px">
      <label>M‚ÇÅ (M‚òâ)</label><input id="m1Input" type="number" value="30" step="0.1" min="1">
      <label>M‚ÇÇ (M‚òâ)</label><input id="m2Input" type="number" value="30" step="0.1" min="1">
      <label>Spin a*</label><input id="spinInput" type="range" min="0" max="1" step="0.01" value="0.5">
      <span id="spinVal" class="muted">0.50</span>
    </div>
    <canvas id="orbitCanvas" width="920" height="380"></canvas>
    <canvas id="chirpCanvas" width="920" height="180"></canvas>
    <div class="row" style="margin-top:6px">
      <button id="playChirpBtn" class="btn">üîä Play Chirp</button>
      <button id="stopChirpBtn" class="btn secondary">‚èπ Stop</button>
    </div>
    <div class="panel" style="margin-top:12px">
      <strong>Summary</strong>
      <h4 class="small muted">Chirp Mass / Freq / Strain</h4>
      <div id="eventSummary" class="smallMuted"></div>
    </div>
  </div>
</div>

<!-- Advanced Tab -->
<div id="advancedTab" class="container tabContent" style="display:none">
  <h2>üìö Advanced Calculators</h2>
  <div class="panel">
    <p class="small">Independent calculators for time dilation, dark matter effects, and PBH density profiles.</p>
    <div class="collapsible">
      <div class="collapsible-header"><h4>Time Dilation near Sgr A*</h4><div class="hint">click to expand</div></div>
      <div class="collapsible-body">
        <p>ÓÄÅ\gamma = \sqrt{1 - \frac{G M}{r c^2}}ÓÄÅ</p>
      </div>
    </div>
    <div class="collapsible">
      <div class="collapsible-header"><h4>Dark Matter Effect</h4><div class="hint">click to expand</div></div>
      <div class="collapsible-body">
        <p>ÓÄÅ\Gamma_{\rm dark} = \Gamma_0(1 + \alpha \rho_{\rm DM})ÓÄÅ</p>
      </div>
    </div>
    <div class="collapsible">
      <div class="collapsible-header"><h4>Primordial Black Hole DM Profile</h4><div class="hint">click to expand</div></div>
<div class="collapsible-body">
        <p>\(\rho_{\rm PBH}(r) = \rho_0 \left(\frac{r}{r_0}\right)^{-\alpha}\)</p>
        <p class="note">Use these calculators independently; they do not affect the event simulator.</p>
      </div>
    </div>
  </div>
</div>

<!-- Tooltip -->
<div class="tooltip" id="tooltip"><span class="close" onclick="this.parentElement.style.display='none'">&times;</span><div id="tooltipContent"></div></div>

<script>
// ================= Tabs =================
const tabs = document.querySelectorAll('.tabButton');
const contents = document.querySelectorAll('.tabContent');
tabs.forEach(tab => tab.addEventListener('click', () => {
  tabs.forEach(t => t.classList.remove('active'));
  contents.forEach(c => c.style.display='none');
  tab.classList.add('active');
  document.getElementById(tab.dataset.tab).style.display='block';
}));

// ================= Collapsible =================
document.querySelectorAll('.collapsible-header').forEach(h => {
  h.addEventListener('click', () => {
    h.parentElement.classList.toggle('open');
  });
});

// ================= Overview BH Canvas =================
const bhCanvas = document.getElementById('bhCanvas');
const bhCtx = bhCanvas.getContext('2d');
function drawBlackHole() {
  const w = bhCanvas.width, h = bhCanvas.height;
  bhCtx.clearRect(0,0,w,h);

  // Stars background
  for(let i=0;i<250;i++){
    bhCtx.fillStyle = `rgba(255,255,255,${Math.random()*0.3})`;
    bhCtx.fillRect(Math.random()*w,Math.random()*h,1,1);
  }

  // Accretion disk
  const grd = bhCtx.createRadialGradient(w/2,h/2,40,w/2,h/2,200);
  grd.addColorStop(0,'rgba(255,200,100,0.25)');
  grd.addColorStop(1,'rgba(0,0,0,0)');
  bhCtx.fillStyle = grd;
  bhCtx.beginPath();
  bhCtx.ellipse(w/2,h/2,200,40,0,0,2*Math.PI);
  bhCtx.fill();

  // Event horizon
  bhCtx.fillStyle='rgba(140,80,255,0.35)';
  bhCtx.beginPath();
  bhCtx.arc(w/2,h/2,40,0,2*Math.PI);
  bhCtx.fill();

  // Jet
  bhCtx.strokeStyle='rgba(120,200,255,0.15)';
  bhCtx.lineWidth=4;
  bhCtx.beginPath();
  bhCtx.moveTo(w/2,h/2-40);
  bhCtx.lineTo(w/2,h/2-200);
  bhCtx.stroke();
  bhCtx.beginPath();
  bhCtx.moveTo(w/2,h/2+40);
  bhCtx.lineTo(w/2,h/2+200);
  bhCtx.stroke();
}
drawBlackHole();

// ================= GW Events Simulator =================
const events = [
  {name:"GW150914", m1:36, m2:29, spin:0.7},
  {name:"GW151226", m1:14, m2:7, spin:0.4},
  {name:"GW170104", m1:31, m2:20, spin:0.5},
  {name:"GW170814", m1:30, m2:25, spin:0.6}
];

const eventSelect = document.getElementById('eventSelect');
events.forEach((e,i)=> {
  const opt = document.createElement('option'); opt.value=i; opt.text=e.name;
  eventSelect.appendChild(opt);
});

const m1Input = document.getElementById('m1Input');
const m2Input = document.getElementById('m2Input');
const spinInput = document.getElementById('spinInput');
const spinVal = document.getElementById('spinVal');
spinInput.addEventListener('input',()=>spinVal.textContent=parseFloat(spinInput.value).toFixed(2));

const orbitCanvas = document.getElementById('orbitCanvas');
const orbitCtx = orbitCanvas.getContext('2d');
const chirpCanvas = document.getElementById('chirpCanvas');
const chirpCtx = chirpCanvas.getContext('2d');

function drawOrbit(m1,m2,spin){
  const w=orbitCanvas.width, h=orbitCanvas.height;
  orbitCtx.clearRect(0,0,w,h);
  const rMax = 150;
  const center = {x:w/2, y:h/2};
  const t = Date.now()*0.002;
  const r1 = rMax*(m2/(m1+m2)), r2 = rMax*(m1/(m1+m2));

  orbitCtx.fillStyle='#f0f'; orbitCtx.beginPath();
  orbitCtx.arc(center.x + r1*Math.cos(t), center.y + r1*Math.sin(t),12,0,2*Math.PI); orbitCtx.fill();

  orbitCtx.fillStyle='#0ff'; orbitCtx.beginPath();
  orbitCtx.arc(center.x - r2*Math.cos(t), center.y - r2*Math.sin(t),12,0,2*Math.PI); orbitCtx.fill();
}

function drawChirp(m1,m2){
  const w=chirpCanvas.width, h=chirpCanvas.height;
  chirpCtx.clearRect(0,0,w,h);
  const N=500;
  for(let i=0;i<N;i++){
    const t=i/N;
    const f = 10+ (m1+m2)*t*5;
    const amp = Math.sin(2*Math.PI*f*t);
    chirpCtx.strokeStyle='rgba(255,255,255,0.6)';
    chirpCtx.beginPath();
    chirpCtx.moveTo(i,h/2);
    chirpCtx.lineTo(i,h/2 - amp*80);
    chirpCtx.stroke();
  }
}

function updateEvent(index){
  const e = events[index];
  m1Input.value=e.m1; m2Input.value=e.m2; spinInput.value=e.spin;
  spinVal.textContent=e.spin.toFixed(2);
  drawOrbit(e.m1,e.m2,e.spin);
  drawChirp(e.m1,e.m2);
  document.getElementById('eventSummary').innerHTML=
    `Chirp Mass ‚âà ${( (e.m1*e.m2)**0.6 / (e.m1+e.m2)**0.2 ).toFixed(2)} M‚òâ`;
}

eventSelect.addEventListener('change',()=>updateEvent(eventSelect.value));
document.getElementById('runCustomBtn').addEventListener('click',()=>{
  drawOrbit(+m1Input.value,+m2Input.value,+spinInput.value);
  drawChirp(+m1Input.value,+m2Input.value);
});
document.getElementById('resetBtn').addEventListener('click',()=>updateEvent(eventSelect.value));

document.getElementById('playChirpBtn').addEventListener('click',()=>{document.getElementById('audioState').textContent='playing';});
document.getElementById('stopChirpBtn').addEventListener('click',()=>{document.getElementById('audioState').textContent='stopped';});

// Initialize default event
updateEvent(0);
</script>
</body>
</html>
