<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBH Simulation Project</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background: radial-gradient(ellipse at center, #000010 0%, #000000 100%); color:white; }
  .tabs { display:flex; background:#111; }
  .tabButton { flex:1; padding:10px; cursor:pointer; background:#222; border:none; color:white; }
  .tabButton.active { background:#555; }
  .tabContent { display:none; padding:10px; }
  canvas { background:rgba(0,0,0,0.6); border:1px solid #444; }
  .miniWindow { background:#111; color:white; border:1px solid #666; padding:10px; position:absolute; top:50px; right:50px; width:300px; max-height:400px; overflow:auto; display:none; z-index:10; }
  .closeBtn { float:right; cursor:pointer; color:red; font-weight:bold; }
  select, button { margin-top:5px; margin-bottom:10px; }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <button class="tabButton active" data-tab="overviewTab">Overview</button>
  <button class="tabButton" data-tab="eventsTab">Events</button>
  <button class="tabButton" data-tab="advancedTab">Advanced Physics</button>
</div>

<!-- Overview Tab -->
<div id="overviewTab" class="tabContent" style="display:block;">
  <h2>Black Hole Overview</h2>
  <canvas id="bhCanvas" width="800" height="400"></canvas>
</div>

<!-- Events Tab -->
<div id="eventsTab" class="tabContent">
  <h2>Gravitational-Wave Events</h2>
  <label for="eventSelect">Choose Event:</label>
  <select id="eventSelect"></select>
  <canvas id="chirpCanvas" width="800" height="300"></canvas>
  <button id="playChirpBtn">Play Chirp</button>
</div>

<!-- Advanced Physics Tab -->
<div id="advancedTab" class="tabContent">
  <h2>Advanced Physics Tools</h2>
  <button onclick="showMiniWindow('formulasWindow')">Show Formulas</button>
  <button onclick="showMiniWindow('simWindow')">Show Advanced Simulators</button>
</div>

<!-- Mini Windows -->
<div id="formulasWindow" class="miniWindow">
  <span class="closeBtn" onclick="this.parentElement.style.display='none'">×</span>
  <h3>GR & GW Formulas</h3>
  <p>Schwarzschild radius: r_s = 2GM/c²</p>
  <p>Chirp mass: ℳ = (M₁ M₂)^(3/5)/(M₁+M₂)^(1/5)</p>
  <p>GW strain (leading PN): h(f) ≈ 4 G^(5/3)/c^4 π^(2/3) ℳ^(5/3) f^(2/3)/D</p>
  <!-- Add more formulas as needed -->
</div>

<div id="simWindow" class="miniWindow">
  <span class="closeBtn" onclick="this.parentElement.style.display='none'">×</span>
  <h3>Advanced Simulators</h3>
  <p>Coming soon: neutrino calculations, custom GW events, PN waveform generation...</p>
</div>

<script>
// --- Tabs functionality ---
const tabButtons = document.querySelectorAll('.tabButton');
const tabContents = document.querySelectorAll('.tabContent');
tabButtons.forEach(btn => {
  btn.addEventListener('click', ()=>{
    tabButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    tabContents.forEach(tc=>tc.style.display='none');
    document.getElementById(btn.dataset.tab).style.display='block';
  });
});

// --- Mini window helper ---
function showMiniWindow(id){ document.getElementById(id).style.display='block'; }

// --- Overview black hole canvas ---
const bhCanvas = document.getElementById('bhCanvas');
const bhCtx = bhCanvas.getContext('2d');
function drawBlackHole(){
  bhCtx.clearRect(0,0,bhCanvas.width,bhCanvas.height);
  // Event horizon
  bhCtx.beginPath();
  bhCtx.arc(bhCanvas.width/2, bhCanvas.height/2, 50, 0, Math.PI*2);
  bhCtx.fillStyle='black';
  bhCtx.fill();
  // Accretion disk
  for(let i=0;i<100;i++){
    bhCtx.beginPath();
    bhCtx.arc(bhCanvas.width/2, bhCanvas.height/2, 60+i, 0, Math.PI*2);
    bhCtx.strokeStyle=`rgba(255,165,0,${0.02*i})`;
    bhCtx.stroke();
  }
}
drawBlackHole();

// --- Events tab ---
// Mock event data
const gwEvents = {
  "GW150914": { m1: 36, m2: 29 },
  "GW170104": { m1: 31, m2: 19 },
  "Custom": { m1: 30, m2: 30 }
};
// Populate event dropdown
const eventSelect = document.getElementById('eventSelect');
for (let key in gwEvents){
  let opt = document.createElement('option'); opt.value=key; opt.text=key; eventSelect.add(opt);
}
// Canvas & audio
const canvas = document.getElementById('chirpCanvas');
const ctx = canvas.getContext('2d');
let waveformData = [];
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
let chirpBuffer;

// Create chirp audio & plot
function createChirpAudioAndPlot(m1,m2,duration=3){
  const sampleRate = audioCtx.sampleRate;
  const length = sampleRate*duration;
  const buffer = audioCtx.createBuffer(1,length,sampleRate);
  const data = buffer.getChannelData(0);
  waveformData=[];
  const f0=20; const f1=400;
  for(let i=0;i<length;i++){
    const t=i/sampleRate;
    const freq=f0+(f1-f0)*(t/duration);
    data[i]=0.2*Math.sin(2*Math.PI*freq*t);
    waveformData.push(data[i]);
  }
  chirpBuffer=buffer;
  drawWaveform();
}

// Draw waveform
function drawWaveform(highlightIndex=-1){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.beginPath();
  ctx.moveTo(0,canvas.height/2);
  for(let i=0;i<waveformData.length;i+=Math.floor(waveformData.length/canvas.width)){
    const x=i/waveformData.length*canvas.width;
    const y=canvas.height/2 - waveformData[i]*canvas.height/2;
    ctx.lineTo(x,y);
  }
  ctx.strokeStyle='orange'; ctx.lineWidth=2; ctx.stroke();
  // Playhead
  if(highlightIndex>=0){
    const x = highlightIndex / waveformData.length * canvas.width;
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height);
    ctx.strokeStyle='red'; ctx.lineWidth=1; ctx.stroke();
  }
}

// Play chirp
document.getElementById('playChirpBtn').addEventListener('click', ()=>{
  if(!chirpBuffer) return;
  const source = audioCtx.createBufferSource();
  source.buffer=chirpBuffer; source.connect(audioCtx.destination);
  const startTime = audioCtx.currentTime;
  const duration = chirpBuffer.duration;
  function animate(){
    const elapsed = audioCtx.currentTime-startTime;
    if(elapsed>duration) return;
    const index = Math.floor(elapsed/duration*waveformData.length);
    drawWaveform(index);
    requestAnimationFrame(animate);
  }
  animate();
  source.start();
});

// Update on event change
eventSelect.addEventListener('change', ()=>{
  const ev = gwEvents[eventSelect.value];
  if(!ev) return;
  createChirpAudioAndPlot(ev.m1,ev.m2);
});

// Initialize first event
createChirpAudioAndPlot(gwEvents[eventSelect.value].m1,gwEvents[eventSelect.value].m2);

</script>
</body>
</html>
