<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBH Gravitational Wave Visualizer</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    color: white;
    background: radial-gradient(circle at center, #0a0a2a, #000010 80%);
    overflow-x: hidden;
  }

  /* twinkling stars */
  .stars {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: transparent url('https://raw.githubusercontent.com/iamshaunjp/webgl-playlist/master/particles/starfield.png') repeat;
    animation: twinkle 200s linear infinite;
    z-index: 0;
    pointer-events: none;
  }

  @keyframes twinkle {
    from {background-position: 0 0;}
    to {background-position: -10000px 10000px;}
  }

  main {
    position: relative;
    z-index: 1;
    padding: 1rem;
    text-align: center;
  }

  .tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
  }
  .tab {
    background: #1b1b2b;
    padding: 0.5rem 1.5rem;
    margin: 0 0.3rem;
    border-radius: 0.5rem;
    cursor: pointer;
  }
  .tab.active { background: #3c3ca8; }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  #exportButton {
    margin-top: 1rem;
    background: #2b84ff;
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 0.4rem;
    font-size: 1rem;
    cursor: pointer;
  }
  #exportButton:hover { background: #479aff; }

  input[type=range] {
    width: 80%;
  }
</style>
</head>
<body>

<div class="stars"></div>

<main>
  <h1>ðŸŒ€ Binary Black Hole Visualizer</h1>
  <div class="tabs">
    <div class="tab active" data-target="preset">Preset Events</div>
    <div class="tab" data-target="custom">Custom Simulation</div>
  </div>

  <!-- Preset tab -->
  <div id="preset" class="tab-content active">
    <div id="orbit3d" style="width:100%;height:300px;"></div>
    <div id="presetWave" style="width:100%;height:250px;"></div>
    <div id="presetSpec" style="width:100%;height:250px;"></div>
    <div id="energyPlot" style="width:100%;height:250px;"></div>
  </div>

  <!-- Custom tab -->
  <div id="custom" class="tab-content">
    <h3>Adjust Black Hole Parameters</h3>
    <label>Mass 1 (solar masses): <span id="m1Label">36</span></label><br>
    <input id="m1Slider" type="range" min="10" max="80" value="36" step="1"><br>
    <label>Mass 2 (solar masses): <span id="m2Label">29</span></label><br>
    <input id="m2Slider" type="range" min="10" max="80" value="29" step="1"><br>
    <button id="exportButton">ðŸ“¤ Export Simulation</button>
  </div>
</main>

<script>
/* Utility functions */
function linspace(a,b,n){const out=[]; for(let i=0;i<n;i++) out.push(a+(b-a)*i/(n-1)); return out;}

/* Generate simple waveform and frequency evolution */
function chirp(p){
  const m1=p.m1,m2=p.m2;const total=Math.max(1,m1+m2);
  const chirpMass=Math.pow((m1*m2),3/5)/Math.pow(total,1/5);
  const dur=5*(30/Math.max(1,chirpMass));
  const sr=512; const N=Math.round(dur*sr);
  const t=[],h=[],f=[];
  const f0=20*Math.sqrt(30/Math.max(1,chirpMass));
  const f1=400*Math.sqrt(30/Math.max(1,chirpMass));
  for(let i=0;i<N;i++){
    const tt=i/sr; const tau=tt/dur;
    const fr=f0+(f1-f0)*Math.pow(tau,3); f.push(fr); t.push(tt);
    const amp=Math.pow(tau,1.7)*Math.exp(-2*(1-tau)); h.push(amp*Math.sin(2*Math.PI*fr*tt));
  }
  return {t,h,f,duration:dur};
}

let params={m1:36,m2:29};
let ts=chirp(params);

/* Initial plots */
function plotAll(){
  Plotly.newPlot("presetWave",
    [{x:ts.t,y:ts.h,mode:'lines',line:{color:'#fff'}}],
    {title:'GW150914 â€” waveform',paper_bgcolor:'transparent',plot_bgcolor:'transparent'},
    {displayModeBar:false});
  Plotly.newPlot("presetSpec",
    [{z:[ts.h],type:'heatmap',colorscale:'Viridis'}],
    {title:'Spectrogram',paper_bgcolor:'transparent',plot_bgcolor:'transparent'},
    {displayModeBar:false});
  Plotly.newPlot("energyPlot",
    [{x:ts.t,y:ts.h.map(v=>v*v),mode:'lines',line:{color:'#ffb86b'}}],
    {title:'Energy (toy model)',paper_bgcolor:'transparent',plot_bgcolor:'transparent'},
    {displayModeBar:false});
  Plotly.newPlot("orbit3d",
    [
      {x:[0.2],y:[0],z:[0],mode:'markers',marker:{size:12,color:'orange'},type:'scatter3d'},
      {x:[-0.2],y:[0],z:[0],mode:'markers',marker:{size:10,color:'cyan'},type:'scatter3d'}
    ],
    {scene:{xaxis:{visible:false},yaxis:{visible:false},zaxis:{visible:false}},paper_bgcolor:'transparent'},
    {displayModeBar:false});
}
plotAll();

/* Tab logic */
document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
    document.getElementById(tab.dataset.target).classList.add("active");
  });
});

/* Custom slider updates */
const m1Slider=document.getElementById('m1Slider');
const m2Slider=document.getElementById('m2Slider');
m1Slider.oninput=()=>{document.getElementById('m1Label').textContent=m1Slider.value;updateCustom();};
m2Slider.oninput=()=>{document.getElementById('m2Label').textContent=m2Slider.value;updateCustom();};

function updateCustom(){
  params.m1=parseFloat(m1Slider.value);
  params.m2=parseFloat(m2Slider.value);
  ts=chirp(params);
  Plotly.react("presetWave",[{x:ts.t,y:ts.h,mode:'lines',line:{color:'#fff'}}]);
  Plotly.react("energyPlot",[{x:ts.t,y:ts.h.map(v=>v*v),mode:'lines',line:{color:'#ffb86b'}}]);
}

/* Export simulation data */
document.getElementById('exportButton').addEventListener('click',()=>{
  let csv="time,strain\n";
  for(let i=0;i<ts.t.length;i++) csv+=`${ts.t[i]},${ts.h[i]}\n`;
  const blob=new Blob([csv],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;a.download="bbh_simulation.csv";a.click();
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>
