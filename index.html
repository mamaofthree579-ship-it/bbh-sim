<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBH Simulation Project</title>
<style>
  body { font-family: Arial, sans-serif; background: #0b0c1a; color: #fff; margin:0; }
  header { background: #1a1b2c; padding: 10px; text-align:center; }
  nav { display:flex; background: #16172b; }
  nav button { flex:1; padding:10px; cursor:pointer; background:#16172b; border:none; color:#fff; }
  nav button.active { background:#27293d; }
  section { display:none; padding:15px; }
  canvas { background: #0b0c1a; display:block; margin:auto; }
  #customParams { display:none; margin-top:10px; background:#1a1b2c; padding:10px; border-radius:5px;}
  .btn { padding:5px 10px; margin:5px; background:#27293d; color:#fff; border:none; cursor:pointer; border-radius:3px; }
  .mini-window { display:none; position:fixed; top:20%; left:20%; width:60%; background:#1a1b2c; border:2px solid #444; padding:15px; z-index:10; }
  .close-btn { float:right; cursor:pointer; color:#ff5555; }
  select, input { margin:5px; padding:3px; background:#27293d; color:#fff; border:none; border-radius:3px; }
  .info-panel { background:#1a1b2c; padding:5px; margin:5px 0; border-radius:3px; }
</style>
</head>
<body>

<header>
  <h1>Binary Black Hole Simulation</h1>
</header>

<nav>
  <button class="tab-btn active" onclick="openTab('overview')">Overview</button>
  <button class="tab-btn" onclick="openTab('events')">Events</button>
  <button class="tab-btn" onclick="openTab('advanced')">Advanced Physics</button>
</nav>

<!-- Overview Tab -->
<section id="overview" style="display:block;">
  <h2>Overview</h2>
  <p>Explore binary black hole mergers and simulated gravitational waveforms.</p>
  <div class="info-panel">
    <strong>3D Orbit Explanation:</strong> Orange and blue spheres represent black holes orbiting each other. Trails show recent motion.
  </div>
  <canvas id="orbit3DOverview" width="400" height="400"></canvas>
  <canvas id="chirpGraphOverview" width="400" height="150"></canvas>
  <button class="btn" onclick="playOverviewChirp()">Play Chirp</button>
  <audio id="chirpAudioOverview" src=""></audio>
</section>

<!-- Events Tab -->
<section id="events">
  <h2>Known Gravitational Wave Events</h2>
  <select id="eventSelect" onchange="onEventChange()">
    <option value="">-- Select Event --</option>
    <option value="GW150914">GW150914</option>
    <option value="GW151226">GW151226</option>
    <option value="GW170104">GW170104</option>
    <option value="GW170817">GW170817</option>
    <option value="Custom">Custom</option>
  </select>

  <div id="customParams">
    <p>Custom BBH Parameters:</p>
    <label>Mass 1 (M☉): <input id="customM1" type="number" value="30"></label>
    <label>Mass 2 (M☉): <input id="customM2" type="number" value="30"></label>
    <button class="btn" onclick="runCustom()">Run Simulation</button>
  </div>

  <div class="info-panel">
    <strong>3D Orbit Explanation:</strong> Orange and blue spheres represent black holes for the selected event. Trails indicate motion history.
  </div>
  <canvas id="orbit3DEvent" width="400" height="400"></canvas>
  <canvas id="chirpGraphEvent" width="400" height="150"></canvas>
  <canvas id="spectrogramEvent" width="400" height="150"></canvas>
  <button class="btn" onclick="playEventChirp()">Play Chirp</button>
  <button class="btn" onclick="exportEventData()">Export Data</button>
  <audio id="chirpAudioEvent" src=""></audio>
</section>

<!-- Advanced Physics Tab -->
<section id="advanced">
  <h2>Advanced Physics</h2>
  <button class="btn" onclick="toggleMiniWindow('ap1')">Show GR Formulas</button>
  <button class="btn" onclick="toggleMiniWindow('ap2')">Show Neutrino Relations</button>
  <div id="ap1" class="mini-window">
    <span class="close-btn" onclick="closeMini('ap1')">✖</span>
    <h3>GR Formulas</h3>
    <p>Schwarzschild radius: r_s = 2GM/c²</p>
    <p>Gravitational potential: Φ(r) ≈ -GM/r</p>
    <p>GW strain: h(t) ≈ (4G/c⁴) d²Q/dt² / R</p>
  </div>
  <div id="ap2" class="mini-window">
    <span class="close-btn" onclick="closeMini('ap2')">✖</span>
    <h3>Neutrino Relations</h3>
    <p>Total neutrino energy: ~10⁵³ erg</p>
    <p>Flux at distance D: F_ν = E_ν / 4πD²</p>
    <p>Time delay (massive ν): Δt ≈ m_ν² c⁴ / 2E² × D/c</p>
  </div>
</section>

<script>
// --- Tab Navigation ---
function openTab(tabId){
  document.querySelectorAll('section').forEach(s=>s.style.display='none');
  document.getElementById(tabId).style.display='block';
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelector('button[onclick="openTab(\''+tabId+'\')"]').classList.add('active');
}

// --- Mock Overview Data & Functions ---
function drawOrbit3D(canvasId, m1, m2){
  const c=document.getElementById(canvasId);
  const ctx=c.getContext('2d');
  ctx.fillStyle='#0b0c1a'; ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle='#ff8800'; ctx.beginPath();
  const x=c.width/2+100*Math.cos(Date.now()/1000); 
  const y=c.height/2+100*Math.sin(Date.now()/1000);
  ctx.arc(x,y,5,0,2*Math.PI); ctx.fill();
  ctx.fillStyle='#00aaff'; ctx.beginPath();
  const x2=c.width/2+80*Math.cos(-Date.now()/1000);
  const y2=c.height/2+80*Math.sin(-Date.now()/1000);
  ctx.arc(x2,y2,5,0,2*Math.PI); ctx.fill();
  requestAnimationFrame(()=>drawOrbit3D(canvasId, m1, m2));
}

function drawChirp(canvasId,m1,m2){
  const c=document.getElementById(canvasId);
  const ctx=c.getContext('2d');
  ctx.clearRect(0,0,c.width,c.height);
  ctx.strokeStyle='#ff8800'; ctx.beginPath();
  for(let i=0;i<c.width;i++){
    const t=i/50;
    const y=c.height/2-50*Math.sin(2*Math.PI*0.2*t*(m1+m2)/50)*Math.exp(-0.002*t);
    if(i===0) ctx.moveTo(i,y); else ctx.lineTo(i,y);
  }
  ctx.stroke();
}

function playOverviewChirp(){document.getElementById("chirpAudioOverview").play();}

// --- Events Data ---
const GW_EVENTS = {
  "GW150914": { m1:36, m2:29, spin1:0.3, spin2:0.2, audio:"audio/GW150914.wav" },
  "GW151226": { m1:14, m2:8, spin1:0.0, spin2:0.0, audio:"audio/GW151226.wav" },
  "GW170104": { m1:31, m2:19, spin1:0.1, spin2:0.2, audio:"audio/GW170104.wav" },
  "GW170817": { m1:1.36, m2:1.36, spin1:0.0, spin2:0.0, audio:"audio/GW170817.wav" }
};

function onEventChange(){
  const val=document.getElementById("eventSelect").value;
  const custom=document.getElementById("customParams");
  if(val==="Custom"){
    custom.style.display="block";
  } else if(GW_EVENTS[val]){
    custom.style.display="none";
    const e=GW_EVENTS[val];
    drawOrbit3D("orbit3DEvent", e.m1, e.m2);
    drawChirp("chirpGraphEvent", e.m1, e.m2);
    drawSpectrogram("spectrogramEvent");
    const audioElem=document.getElementById("chirpAudioEvent");
    audioElem.src=e.audio;
  } else {
    custom.style.display="none";
  }
}

function playEventChirp(){document.getElementById("chirpAudioEvent").play();}

function runCustom(){
  const m1=parseFloat(document.getElementById("customM1").value);
  const m2=parseFloat(document.getElementById("customM2").value);
  drawOrbit3D("orbit3DEvent", m1,m2);
  drawChirp("chirpGraphEvent", m1,m2);
  drawSpectrogram("spectrogramEvent");
}

// --- Export Data ---
function exportEventData(){
  const val=document.getElementById("eventSelect").value;
  let data={};
  if(val==="Custom"){
    data.m1=document.getElementById("customM1").value;
    data.m2=document.getElementById("customM2").value;
    data.event="Custom";
  } else data=GW_EVENTS[val];
  const blob=new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url; a.download='bbh_event.json'; a.click();
  URL.revokeObjectURL(url);
}

// --- Mini Windows ---
function toggleMiniWindow(id){document.getElementById(id).style.display='block';}
function closeMini(id){document.getElementById(id).style.display='none';}

  // --- Spectrogram Mock ---
function drawSpectrogram(canvasId){
  const c = document.getElementById(canvasId);
  const ctx = c.getContext('2d');
  ctx.fillStyle = '#0b0c1a';
  ctx.fillRect(0, 0, c.width, c.height);
  for(let i = 0; i < 100; i++){
    for(let j = 0; j < 50; j++){
      ctx.fillStyle = `rgba(${i*2}, ${j*5}, 255, 0.5)`;
      ctx.fillRect(i*4, j*3, 4, 3);
    }
  }
}

// --- Initialize Overview Visuals ---
drawOrbit3D("orbit3DOverview", 30, 30);
drawChirp("chirpGraphOverview", 30, 30);

</script>

</body>
</html>
