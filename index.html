<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BBH Simulation</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #eee; margin:0; padding:0; }
  h2 { margin-top:0; }
  .tabButtons { display:flex; background:#222; }
  .tabButtons button { flex:1; padding:10px; background:#333; color:#eee; border:none; cursor:pointer; }
  .tabButtons button.active { background:#555; }
  .tabContent { display:none; padding:10px; }
  canvas { display:block; background:#000; margin:10px 0; border:1px solid #444; }
  #customControls { margin-top:10px; }
  input { width:60px; margin:0 5px; }
  .miniWindow { background:#222; border:1px solid #555; padding:10px; margin:10px 0; display:none; }
  .miniWindow button.closeBtn { float:right; background:red; color:#fff; border:none; cursor:pointer; }
</style>
</head>
<body>

<!-- Tab Buttons -->
<div class="tabButtons">
  <button class="tabBtn active" data-tab="overviewTab">Overview</button>
  <button class="tabBtn" data-tab="eventsTab">Events</button>
  <button class="tabBtn" data-tab="advancedTab">Advanced Physics</button>
</div>

<!-- Overview Tab -->
<div id="overviewTab" class="tabContent" style="display:block;">
  <h2>Black Hole Overview</h2>
  <canvas id="bhCanvas" width="800" height="400"></canvas>
  <p>Single black hole visualization. No chirp here.</p>
</div>

<!-- Events Tab -->
<div id="eventsTab" class="tabContent">
  <h2>Gravitational-Wave Events</h2>
  <label for="eventSelect">Choose Event:</label>
  <select id="eventSelect"></select>

  <canvas id="orbitCanvas" width="800" height="400"></canvas>
  <canvas id="chirpCanvas" width="800" height="200"></canvas>
  <button id="playChirpBtn">Play Chirp</button>
  <canvas id="specCanvas" width="800" height="200"></canvas>

  <div id="customControls">
    <h3>Custom Simulation</h3>
    <label>Mass 1: <input type="number" id="m1Input" value="30"></label>
    <label>Mass 2: <input type="number" id="m2Input" value="30"></label>
    <label>Separation: <input type="number" id="sepInput" value="100"></label>
    <button id="runCustomBtn">Run Custom Simulation</button>
  </div>
</div>

<!-- Advanced Physics Tab -->
<div id="advancedTab" class="tabContent">
  <h2>Advanced Physics</h2>
  <button class="advBtn" data-window="window1">Show Formulas & Notes</button>
  <div id="window1" class="miniWindow">
    <button class="closeBtn">X</button>
    <pre>
# Schwarzschild radius
r_s = 2GM/c^2
# Binary inspiral chirp mass
M_chirp = (M1*M2)^(3/5)/(M1+M2)^(1/5)
# GW frequency evolution
df/dt = 96/5 pi^(8/3) (G*M_chirp)^(5/3)/c^5 f^(11/3)
...
# Additional formulas and phenomenological neutrino couplings
...
    </pre>
  </div>
</div>

<script>
// --- Tab switching ---
const tabButtons = document.querySelectorAll('.tabBtn');
const tabs = document.querySelectorAll('.tabContent');
tabButtons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabButtons.forEach(b=>b.classList.remove('active'));
    tabs.forEach(t=>t.style.display='none');
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).style.display='block';
  });
});

// --- Mini window logic ---
document.querySelectorAll('.advBtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{ document.getElementById(btn.dataset.window).style.display='block'; });
});
document.querySelectorAll('.miniWindow .closeBtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{ btn.parentElement.style.display='none'; });
});

// --- Overview BH visualization ---
const bhCanvas = document.getElementById('bhCanvas');
const bhCtx = bhCanvas.getContext('2d');
bhCtx.fillStyle='white';
bhCtx.beginPath();
bhCtx.arc(bhCanvas.width/2,bhCanvas.height/2,50,0,Math.PI*2);
bhCtx.fill();

// --- 3D Orbit Events ---
const orbitCanvas = document.getElementById('orbitCanvas');
const oCtx = orbitCanvas.getContext('2d');
let orbitAngle = 0;

function drawOrbit(m1, m2, separation){
  oCtx.clearRect(0,0,orbitCanvas.width,orbitCanvas.height);
  const cx = orbitCanvas.width/2;
  const cy = orbitCanvas.height/2;
  const r1 = separation*m2/(m1+m2);
  const r2 = separation*m1/(m1+m2);
  const x1 = cx + r1*Math.cos(orbitAngle);
  const y1 = cy + r1*Math.sin(orbitAngle);
  const x2 = cx - r2*Math.cos(orbitAngle);
  const y2 = cy - r2*Math.sin(orbitAngle);

  oCtx.beginPath();
  oCtx.arc(x1,y1,8,0,Math.PI*2); oCtx.fillStyle='orange'; oCtx.fill();
  oCtx.beginPath();
  oCtx.arc(x2,y2,8,0,Math.PI*2); oCtx.fillStyle='blue'; oCtx.fill();
  orbitAngle +=0.02;
  requestAnimationFrame(()=>drawOrbit(m1,m2,separation));
}

// --- Events & Custom Simulation ---
const gwEvents = {
  "GW150914": { m1:36, m2:29, sep:100 },
  "GW170104": { m1:31, m2:19, sep:90 },
  "Custom": { m1:30, m2:30, sep:100 }
};
const eventSelect = document.getElementById('eventSelect');
for(let key in gwEvents){ let opt=document.createElement('option'); opt.value=key; opt.text=key; eventSelect.add(opt); }

function createChirpAudioAndPlot(m1,m2){
  const chirpCanvas = document.getElementById('chirpCanvas');
  const cCtx = chirpCanvas.getContext('2d');
  cCtx.clearRect(0,0,chirpCanvas.width,chirpCanvas.height);
  const t = Array.from({length:2000},(_,i)=>i*0.05);
  const h_plus = t.map(v=>Math.sin(0.2*v)*Math.exp(-0.002*v));
  const h_cross = t.map(v=>Math.cos(0.2*v)*Math.exp(-0.002*v));
  cCtx.strokeStyle='orange'; cCtx.beginPath();
  h_plus.forEach((val,i)=>{ if(i==0)cCtx.moveTo(i,100-val*50); else cCtx.lineTo(i,100-val*50); });
  cCtx.stroke();
  cCtx.strokeStyle='blue'; cCtx.beginPath();
  h_cross.forEach((val,i)=>{ if(i==0)cCtx.moveTo(i,100-val*50); else cCtx.lineTo(i,100-val*50); });
  cCtx.stroke();
}

function updateSimulation(eventKey){
  const ev = gwEvents[eventKey];
  drawOrbit(ev.m1, ev.m2, ev.sep);
  createChirpAudioAndPlot(ev.m1, ev.m2);
}
eventSelect.addEventListener('change', ()=>{ updateSimulation(eventSelect.value); });
document.getElementById('runCustomBtn').addEventListener('click', ()=>{
  const m1=parseFloat(document.getElementById('m1Input').value);
  const m2=parseFloat(document.getElementById('m2Input').value);
  const sep=parseFloat(document.getElementById('sepInput').value);
  drawOrbit(m1,m2,sep);
  createChirpAudioAndPlot(m1,m2);
});
updateSimulation(eventSelect.value);

// --- Spectrogram mock ---
const specCanvas = document.getElementById('specCanvas');
const sCtx = specCanvas.getContext('2d');
function drawSpectrogram(){
  sCtx.clearRect(0,0,specCanvas.width,specCanvas.height);
  const width = specCanvas.width;
  const height = specCanvas.height;
  for(let x=0;x<width;x++){
    const intensity=Math.abs(Math.sin(x/20 + orbitAngle));
    sCtx.fillStyle=`rgba(255,165,0,${intensity*0.3})`;
    sCtx.fillRect(x,0,1,height);
  }
  requestAnimationFrame(drawSpectrogram);
}
drawSpectrogram();
</script>
</body>
</html>
