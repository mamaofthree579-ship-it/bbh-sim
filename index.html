!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üåÄ BBH Simulation ‚Äì 3D Spacetime Ripple</title>

  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at center, #0a0a0a 60%, #000 100%);
      color: #e6e6e6;
      font-family: system-ui, sans-serif;
      text-align: center;
      overflow: hidden;
    }
    h1 {
      position: absolute;
      top: 12px;
      width: 100%;
      text-align: center;
      color: #00b4ff;
      font-size: 1.6rem;
      z-index: 10;
      text-shadow: 0 0 8px #00b4ff80;
    }
    #canvas3D {
      display: block;
      margin: 0 auto;
      width: 100vw;
      height: 100vh;
      background: #000;
    }
    button {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #00b4ff;
      color: white;
      border: none;
      padding: 0.7rem 1.3rem;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
      z-index: 10;
    }
    button:hover {
      background: #0093d1;
    }
  </style>
</head>
<body>
  <h1>üåÄ Spacetime Ripple from a Binary Black Hole Merger</h1>
  <canvas id="canvas3D"></canvas>
  <button id="startBtn">‚ñ∂Ô∏è Play Simulation</button>

  <script>
    const canvas = document.getElementById("canvas3D");
    const ctx = canvas.getContext("2d");
    let w, h;
    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    const gridSize = 30;
    const spacing = 25;
    const originX = w / 2;
    const originY = h / 2;
    const N = 2000;
    const dt = 0.0005;
    const t = Array.from({ length: N }, (_, i) => i * dt);

    const f_start = 30, f_end = 250;
    const f_t = t.map(x => f_start + (f_end - f_start) * Math.pow(x / t[t.length - 1], 2));
    const amp_scale = t.map(x => Math.pow(x / t[t.length - 1], 3));
    const hPlus = t.map((x, i) => amp_scale[i] * Math.sin(2 * Math.PI * f_t[i] * x) * Math.exp(-x * 100));
    const hCross = t.map((x, i) => amp_scale[i] * Math.cos(2 * Math.PI * f_t[i] * x) * Math.exp(-x * 100));

    let frame = 0;
    let playing = false;
    let animId;

    function drawGrid(strainPlus, strainCross) {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, w, h);
      ctx.strokeStyle = "#0af";
      ctx.lineWidth = 1.2;

      const angle = Math.PI / 6; // viewing angle
      const scale = 1.2;

      for (let i = -gridSize; i <= gridSize; i++) {
        ctx.beginPath();
        for (let j = -gridSize; j <= gridSize; j++) {
          const x = i * spacing;
          const y = j * spacing;

          const dx = x * strainPlus - y * strainCross;
          const dy = y * strainPlus + x * strainCross;

          const sx = originX + (x + dx) * scale;
          const sy = originY + (y + dy) * Math.cos(angle) - 80 * Math.sin(angle) * Math.sin((i + j + frame / 40));

          if (j === -gridSize) ctx.moveTo(sx, sy);
          else ctx.lineTo(sx, sy);
        }
        ctx.stroke();
      }

      for (let j = -gridSize; j <= gridSize; j++) {
        ctx.beginPath();
        for (let i = -gridSize; i <= gridSize; i++) {
          const x = i * spacing;
          const y = j * spacing;

          const dx = x * strainPlus - y * strainCross;
          const dy = y * strainPlus + x * strainCross;

          const sx = originX + (x + dx) * scale;
          const sy = originY + (y + dy) * Math.cos(angle) - 80 * Math.sin(angle) * Math.sin((i + j + frame / 40));

          if (i === -gridSize) ctx.moveTo(sx, sy);
          else ctx.lineTo(sx, sy);
        }
        ctx.stroke();
      }

      ctx.fillStyle = "#0ff";
      ctx.font = "18px system-ui";
      ctx.fillText(`Time: ${(frame * dt * 1000).toFixed(1)} ms`, 20, 30);
    }

    function animate() {
      if (!playing) return;
      const strainPlus = hPlus[frame] * 4;
      const strainCross = hCross[frame] * 4;

      drawGrid(strainPlus, strainCross);
      frame += 10;
      if (frame < N) {
        animId = requestAnimationFrame(animate);
      } else {
        playing = false;
        document.getElementById("startBtn").textContent = "üîÅ Replay";
      }
    }

    document.getElementById("startBtn").addEventListener("click", () => {
      if (!playing) {
        playing = true;
        frame = 0;
        document.getElementById("startBtn").textContent = "‚è∏Ô∏è Playing...";
        animate();
      } else {
        cancelAnimationFrame(animId);
        playing = false;
        document.getElementById("startBtn").textContent = "‚ñ∂Ô∏è Play Simulation";
      }
    });

    drawGrid(0, 0);
  </script>
</body>
</html>
