!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸŒ€ BBH Simulation â€“ Chirping Waveform</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: #0b0b0b;
      color: #e6e6e6;
      text-align: center;
      padding: 1.5rem;
    }
    h1 {
      color: #00b4ff;
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }
    canvas {
      display: block;
      margin: 1.2rem auto;
      background: #111;
      border-radius: 12px;
      max-width: 800px;
      width: 95%;
      height: 400px;
    }
    .label {
      color: #aaa;
      font-size: 0.9rem;
      margin-top: -0.5rem;
    }
    footer {
      margin-top: 2rem;
      font-size: 0.9rem;
      color: #888;
    }
  </style>
</head>
<body>
  <h1>ðŸŒ€ Binary Black Hole Chirp</h1>
  <p>(Time and Frequency Domain â€“ Realistic Inspiral & Ringdown)</p>

  <canvas id="timePlot" width="800" height="400"></canvas>
  <div class="label">Time [ms]</div>
  <canvas id="freqPlot" width="800" height="400"></canvas>
  <div class="label">Frequency [Hz]</div>

  <script>
    // --- Generate a chirping waveform ---
    const N = 2000;
    const dt = 0.0005; // seconds per sample (2 kHz sampling)
    const t = Array.from({ length: N }, (_, i) => i * dt); // seconds
    const f_start = 30;  // start frequency (Hz)
    const f_end = 250;   // end frequency (Hz)
    const tau = 0.5;     // controls how fast frequency increases
    const amp_scale = t.map(x => Math.pow(x / t[t.length - 1], 3)); // amplitude rise
    const f_t = t.map(x => f_start + (f_end - f_start) * Math.pow(x / (t[t.length - 1]), 2)); // chirp

    const hPlus = t.map((x, i) =>
      amp_scale[i] * Math.sin(2 * Math.PI * f_t[i] * x) * Math.exp(-x * 100)
    );
    const hCross = t.map((x, i) =>
      amp_scale[i] * Math.cos(2 * Math.PI * f_t[i] * x) * Math.exp(-x * 100)
    );

    // --- FFT function ---
    function fftMag(signal) {
      const N = signal.length;
      const re = new Array(N).fill(0);
      const im = new Array(N).fill(0);
      for (let k = 0; k < N; k++) {
        for (let n = 0; n < N; n++) {
          const angle = (2 * Math.PI * k * n) / N;
          re[k] += signal[n] * Math.cos(angle);
          im[k] -= signal[n] * Math.sin(angle);
        }
      }
      return re.map((r, i) => Math.sqrt(r*r + im[i]*im[i]) / N).slice(0, N/2);
    }

    // --- Drawing helpers ---
    function drawWave(ctx, data, color, offset, scaleY) {
      const w = ctx.canvas.width, h = ctx.canvas.height;
      ctx.beginPath();
      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      const stepX = w / data.length;
      data.forEach((v, i) => {
        const x = i * stepX;
        const y = h / 2 - v * scaleY + offset;
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      });
      ctx.stroke();
    }

    // --- Time-domain plot ---
    const ctxT = document.getElementById('timePlot').getContext('2d');
    const w = ctxT.canvas.width, h = ctxT.canvas.height;
    const maxVal = Math.max(...hPlus.map(Math.abs), ...hCross.map(Math.abs));
    const scaleY = h / (2.5 * maxVal);

    ctxT.fillStyle = "#111";
    ctxT.fillRect(0, 0, w, h);
    ctxT.strokeStyle = "#333";
    for (let i = 0; i < 10; i++) {
      const y = (i / 10) * h;
      ctxT.beginPath();
      ctxT.moveTo(0, y);
      ctxT.lineTo(w, y);
      ctxT.stroke();
    }
    drawWave(ctxT, hPlus, "#00b4ff", -5, scaleY);
    drawWave(ctxT, hCross, "#ffffff", +5, scaleY);
    ctxT.fillStyle = "#e6e6e6";
    ctxT.font = "16px system-ui";
    ctxT.fillText("hâ‚Š (blue)", 20, 25);
    ctxT.fillText("hÃ— (white)", 20, 45);
    ctxT.fillText("Time Domain", w - 170, 25);

    // --- Frequency-domain plot ---
    const fft = fftMag(hPlus);
    const freq = Array.from({ length: N / 2 }, (_, i) => i / (N * dt));
    const ctxF = document.getElementById('freqPlot').getContext('2d');
    const wf = ctxF.canvas.width, hf = ctxF.canvas.height;
    const maxAmp = Math.max(...fft);
    const scaleYf = hf / (1.2 * maxAmp);
    const stepXf = wf / (N / 2);

    ctxF.fillStyle = "#111";
    ctxF.fillRect(0, 0, wf, hf);
    ctxF.strokeStyle = "#333";
    for (let i = 0; i < 10; i++) {
      const y = (i / 10) * hf;
      ctxF.beginPath();
      ctxF.moveTo(0, y);
      ctxF.lineTo(wf, y);
      ctxF.stroke();
    }
    ctxF.beginPath();
    ctxF.strokeStyle = "#00ff88";
    ctxF.lineWidth = 2;
    fft.forEach((v, i) => {
      const x = i * stepXf;
      const y = hf - v * scaleYf;
      i === 0 ? ctxF.moveTo(x, y) : ctxF.lineTo(x, y);
    });
    ctxF.stroke();
    ctxF.fillStyle = "#e6e6e6";
    ctxF.font = "16px system-ui";
    ctxF.fillText("Frequency Domain", wf - 200, 25);
    ctxF.fillText("Power peaks near 250 Hz", 20, 25);
  </script>

  <footer>
    <p>BBH-Sim Open Project â€¢ Chirping Waveform Visualization</p>
  </footer>
</body>
</html>
